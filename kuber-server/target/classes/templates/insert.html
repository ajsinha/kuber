<!DOCTYPE html>
<!--
  ~ Copyright Â© 2025-2030, All Rights Reserved
  ~ Ashutosh Sinha | Email: ajsinha@gmail.com
  -->
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head('Insert Entry')}"></head>
<body class="d-flex flex-column min-vh-100">

<nav th:replace="~{layout :: navbar}"></nav>

<main class="flex-fill">
    <div th:replace="~{layout :: alerts}"></div>
    
    <div class="container-fluid py-4">
        <div class="row mb-4">
            <div class="col">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a th:href="@{/cache}">Cache</a></li>
                        <li class="breadcrumb-item active">Insert Entry</li>
                    </ol>
                </nav>
                <h2 class="mt-2">
                    <i class="fas fa-plus-circle me-2"></i>
                    Insert New Entry
                </h2>
            </div>
        </div>
        
        <div class="row">
            <div class="col-lg-8">
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <form th:action="@{/cache/insert}" method="post" id="insertForm">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="region" class="form-label">Region</label>
                                    <select id="region" name="region" class="form-select">
                                        <option th:each="r : ${regions}" 
                                                th:value="${r.name}" 
                                                th:text="${r.name}"
                                                th:selected="${r.name == currentRegion}">
                                        </option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="valueType" class="form-label">Value Type</label>
                                    <select id="valueType" name="valueType" class="form-select" onchange="toggleEditor()">
                                        <option value="string">String</option>
                                        <option value="json">JSON</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="key" class="form-label">Key</label>
                                <input type="text" id="key" name="key" class="form-control" 
                                       placeholder="e.g., user:1001" required>
                                <small class="text-muted">Use a unique identifier. Convention: type:id (e.g., user:1001)</small>
                            </div>
                            
                            <div class="mb-3">
                                <label for="value" class="form-label">Value</label>
                                <textarea id="value" name="value" class="form-control" rows="10" 
                                          placeholder="Enter value..." required></textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label for="ttl" class="form-label">TTL (Time-To-Live)</label>
                                <div class="input-group">
                                    <input type="number" id="ttl" name="ttl" class="form-control" 
                                           value="-1" min="-1">
                                    <span class="input-group-text">seconds</span>
                                </div>
                                <small class="text-muted">Set to -1 for no expiration</small>
                            </div>
                            
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-1"></i> Save Entry
                                </button>
                                <a th:href="@{/cache(region=${currentRegion})}" class="btn btn-outline-secondary">
                                    <i class="fas fa-times me-1"></i> Cancel
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white border-0 py-3">
                        <h6 class="mb-0">
                            <i class="fas fa-info-circle me-2 text-info"></i>
                            Tips
                        </h6>
                    </div>
                    <div class="card-body">
                        <h6 class="text-muted">Key Naming</h6>
                        <ul class="small text-muted mb-3">
                            <li>Use colons for namespacing: <code>user:1001</code></li>
                            <li>Be consistent with naming patterns</li>
                            <li>Avoid special characters</li>
                        </ul>
                        
                        <h6 class="text-muted">JSON Values</h6>
                        <ul class="small text-muted mb-3">
                            <li>Must be valid JSON</li>
                            <li>Supports nested objects and arrays</li>
                            <li>Enables JSON queries with JSEARCH</li>
                        </ul>
                        
                        <h6 class="text-muted">TTL</h6>
                        <ul class="small text-muted mb-0">
                            <li>-1 = Never expires</li>
                            <li>Positive number = Expires after N seconds</li>
                            <li>Good for session data, temporary caches</li>
                        </ul>
                    </div>
                </div>
                
                <div class="card border-0 shadow-sm mt-4" id="jsonValidator" style="display: none;">
                    <div class="card-header bg-white border-0 py-3">
                        <h6 class="mb-0">
                            <i class="fas fa-check-circle me-2 text-success"></i>
                            JSON Validation
                        </h6>
                    </div>
                    <div class="card-body">
                        <div id="jsonStatus" class="alert alert-info mb-0">
                            <i class="fas fa-info-circle me-1"></i>
                            Enter JSON to validate
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Glossary Card -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card border-0 shadow-sm bg-light">
                    <div class="card-body">
                        <h6 class="card-title text-muted mb-3">
                            <i class="fas fa-question-circle me-2"></i>Glossary
                        </h6>
                        <div class="row small">
                            <div class="col-md-4">
                                <dl class="mb-0">
                                    <dt>Key</dt>
                                    <dd class="text-muted">Unique identifier for the entry. Must be unique within the region.</dd>
                                    <dt>Value (JSON)</dt>
                                    <dd class="text-muted">The data to store, must be valid JSON format.</dd>
                                </dl>
                            </div>
                            <div class="col-md-4">
                                <dl class="mb-0">
                                    <dt>TTL (Time To Live)</dt>
                                    <dd class="text-muted">Seconds until the entry expires. -1 or empty means never expire.</dd>
                                    <dt>Region</dt>
                                    <dd class="text-muted">Target namespace where the entry will be stored.</dd>
                                </dl>
                            </div>
                            <div class="col-md-4">
                                <dl class="mb-0">
                                    <dt>JSON Validation</dt>
                                    <dd class="text-muted">Real-time check that your value is valid JSON before saving.</dd>
                                    <dt>Overwrite</dt>
                                    <dd class="text-muted">If key exists, the value will be replaced with the new data.</dd>
                                </dl>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{layout :: footer}"></footer>
<th:block th:replace="~{layout :: scripts}"></th:block>

<script>
    function toggleEditor() {
        const valueType = document.getElementById('valueType').value;
        const jsonValidator = document.getElementById('jsonValidator');
        const valueField = document.getElementById('value');
        
        if (valueType === 'json') {
            jsonValidator.style.display = 'block';
            valueField.placeholder = '{\n  "name": "John",\n  "age": 30\n}';
        } else {
            jsonValidator.style.display = 'none';
            valueField.placeholder = 'Enter value...';
        }
    }
    
    function validateJson() {
        const value = document.getElementById('value').value;
        const status = document.getElementById('jsonStatus');
        const valueType = document.getElementById('valueType').value;
        
        if (valueType !== 'json' || !value.trim()) {
            status.className = 'alert alert-info mb-0';
            status.innerHTML = '<i class="fas fa-info-circle me-1"></i> Enter JSON to validate';
            return;
        }
        
        try {
            JSON.parse(value);
            status.className = 'alert alert-success mb-0';
            status.innerHTML = '<i class="fas fa-check-circle me-1"></i> Valid JSON';
        } catch (e) {
            status.className = 'alert alert-danger mb-0';
            status.innerHTML = '<i class="fas fa-times-circle me-1"></i> Invalid: ' + e.message;
        }
    }
    
    document.getElementById('value').addEventListener('input', validateJson);
    document.getElementById('insertForm').addEventListener('submit', function(e) {
        const valueType = document.getElementById('valueType').value;
        const value = document.getElementById('value').value;
        
        if (valueType === 'json') {
            try {
                JSON.parse(value);
            } catch (err) {
                e.preventDefault();
                alert('Invalid JSON: ' + err.message);
            }
        }
    });
</script>

</body>
</html>
