# ==============================================================================
# Kuber Distributed Cache - Application Configuration
# Copyright (c) 2025-2030, All Rights Reserved
# Ashutosh Sinha | Email: ajsinha@gmail.com
# ==============================================================================

# Application Branding
server.app.name=Kuber

# Spring Application
spring.application.name=kuber-cache

# Thymeleaf Configuration
spring.thymeleaf.cache=false
spring.thymeleaf.mode=HTML
spring.thymeleaf.encoding=UTF-8
spring.thymeleaf.prefix=classpath:/templates/
spring.thymeleaf.suffix=.html
spring.thymeleaf.check-template-location=true

# Server Configuration
server.port=8080
server.servlet.session.timeout=30m
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=30s

# Actuator Endpoints
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=always

# Logging Configuration
logging.level.root=INFO
logging.level.com.kuber=DEBUG
logging.level.org.apache.mina=WARN
logging.level.org.springframework.security=WARN
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# ==============================================================================
# Kuber Cache Configuration
# ==============================================================================

# Network Configuration
kuber.network.port=6380
kuber.network.bind-address=0.0.0.0
kuber.network.decoder-max-line-length=1048576
kuber.network.connection-timeout-ms=30000
kuber.network.read-timeout-ms=30000
kuber.network.read-buffer-size=2048
kuber.network.write-buffer-size=2048
kuber.network.max-connections=10000
kuber.network.io-processor-count=0

# Cache Configuration
kuber.cache.max-memory-entries=100000
# persistent-mode: true = sync writes to MongoDB, false = async writes
# Note: Regions are ALWAYS persisted to MongoDB regardless of this setting
kuber.cache.persistent-mode=false
kuber.cache.persistence-batch-size=100
kuber.cache.persistence-interval-ms=1000
kuber.cache.default-ttl-seconds=-1
kuber.cache.eviction-policy=LRU
kuber.cache.ttl-cleanup-interval-seconds=60
kuber.cache.enable-statistics=true

# Off-Heap Key Index Configuration (v1.2.2)
# Store keys in direct memory (DRAM) outside Java heap for zero GC pressure
# Recommended for millions of keys to eliminate GC pauses affecting key lookups
kuber.cache.off-heap-key-index=false
# Initial buffer size per region in MB (grows automatically up to max)
kuber.cache.off-heap-key-index-initial-size-mb=16
# Maximum buffer size per region in MB
kuber.cache.off-heap-key-index-max-size-mb=1024

# MongoDB Configuration
kuber.mongo.uri=mongodb://localhost:27017
kuber.mongo.database=kuber
kuber.mongo.connection-pool-size=50
kuber.mongo.connect-timeout-ms=10000
kuber.mongo.socket-timeout-ms=30000
kuber.mongo.server-selection-timeout-ms=30000
kuber.mongo.write-concern=ACKNOWLEDGED

# ==============================================================================
# Persistence Configuration
# ==============================================================================
# Supported types: mongodb, sqlite, postgresql, rocksdb, memory
kuber.persistence.type=rocksdb

# SQLite Configuration (used when persistence.type=sqlite)
kuber.persistence.sqlite.path=./data/kuber.db

# PostgreSQL Configuration (used when persistence.type=postgresql)
kuber.persistence.postgresql.url=jdbc:postgresql://localhost:5432/kuber
kuber.persistence.postgresql.username=kuber
kuber.persistence.postgresql.password=kuber
kuber.persistence.postgresql.pool-size=10
kuber.persistence.postgresql.min-idle=2
kuber.persistence.postgresql.connection-timeout-ms=30000
kuber.persistence.postgresql.idle-timeout-ms=600000
kuber.persistence.postgresql.max-lifetime-ms=1800000

# RocksDB Configuration (used when persistence.type=rocksdb)
kuber.persistence.rocksdb.path=./data/rocksdb
# Enable automatic compaction to reclaim disk space
kuber.persistence.rocksdb.compaction-enabled=true
# Cron expression for scheduled compaction (default: 2:00 AM daily)
# Format: second minute hour day-of-month month day-of-week
# Examples: "0 0 2 * * ?" (2AM daily), "0 0 3 * * SUN" (3AM Sundays), "0 0 */6 * * ?" (every 6 hours)
kuber.persistence.rocksdb.compaction-cron=0 0 2 * * ?

# ZooKeeper Configuration (for replication)
kuber.zookeeper.enabled=false
kuber.zookeeper.connect-string=localhost:2181
kuber.zookeeper.session-timeout-ms=30000
kuber.zookeeper.connection-timeout-ms=10000
kuber.zookeeper.base-path=/kuber
kuber.zookeeper.retry-base-sleep-ms=1000
kuber.zookeeper.retry-max-attempts=3

# Replication Configuration
kuber.replication.sync-batch-size=1000
kuber.replication.sync-timeout-ms=30000
kuber.replication.heartbeat-interval-ms=5000
kuber.replication.primary-check-interval-ms=10000

# Security Configuration
kuber.security.users-file=classpath:users.json
# API Keys file location (default: config/apikeys.json)
kuber.security.api-keys-file=config/apikeys.json
kuber.security.session-timeout-minutes=30
kuber.security.redis-password=

# ==============================================================================
# Autoload Configuration
# ==============================================================================
# Automatically load data from CSV and JSON files placed in inbox folder
kuber.autoload.enabled=true
kuber.autoload.directory=./autoload
kuber.autoload.scan-interval-seconds=60
kuber.autoload.max-records-per-file=0
kuber.autoload.create-directories=true
kuber.autoload.file-encoding=UTF-8

# Memory Management Configuration
# Enable automated memory watcher for 24x7 operation
kuber.cache.memory-watcher-enabled=true
# High watermark - start evicting when heap exceeds this percentage
kuber.cache.memory-high-watermark-percent=85
# Low watermark - stop evicting when heap drops below this percentage
kuber.cache.memory-low-watermark-percent=50
# Number of entries to evict per batch
kuber.cache.memory-eviction-batch-size=1000
# Interval between memory checks (milliseconds)
kuber.cache.memory-watcher-interval-ms=5000
