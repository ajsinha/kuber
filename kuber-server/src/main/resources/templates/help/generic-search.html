<!DOCTYPE html>
<!--
  ~ Copyright © 2025-2030, All Rights Reserved
  ~ Ashutosh Sinha | Email: ajsinha@gmail.com
  ~ Patent Pending
  -->
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head('Generic Search &amp; Update API')}"></head>
<body class="d-flex flex-column min-vh-100">

<nav th:replace="~{layout :: navbar}"></nav>

<main class="flex-fill">
    <div class="container-fluid py-4">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/help"><i class="fas fa-book me-1"></i>Help</a></li>
                <li class="breadcrumb-item active" aria-current="page">Generic Search &amp; Update API</li>
            </ol>
        </nav>

        <!-- Content -->
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <h1 class="display-5 mb-4"><i class="fas fa-search-plus me-3 text-primary"></i>Generic Search &amp; Update API</h1>
                
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Version 2.6.0 Enhanced</strong> - Unified search and update API with multi-key, multi-pattern, advanced JSON search, and smart merge capabilities.
                </div>
                
                <!-- Quick Navigation -->
                <div class="card mb-4 border-primary">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-compass me-2"></i>Quick Navigation</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6><i class="fas fa-search me-2"></i>Search API</h6>
                                <ul class="list-unstyled ms-3">
                                    <li><a href="#search-overview">Overview</a></li>
                                    <li><a href="#search-request">Request Format</a></li>
                                    <li><a href="#search-modes">Search Modes</a></li>
                                    <li><a href="#search-examples">Examples</a></li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6><i class="fas fa-edit me-2"></i>Update API</h6>
                                <ul class="list-unstyled ms-3">
                                    <li><a href="#update-overview">Overview</a></li>
                                    <li><a href="#update-request">Request Format</a></li>
                                    <li><a href="#update-merge">Smart Merge</a></li>
                                    <li><a href="#update-examples">Examples</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ========================================== -->
                <!-- SEARCH API SECTION                         -->
                <!-- ========================================== -->
                <h2 class="border-bottom pb-2 mb-4" id="search-overview"><i class="fas fa-search me-2 text-primary"></i>Generic Search API</h2>

                <!-- Overview -->
                <div class="card mb-4">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Overview</h5>
                    </div>
                    <div class="card-body">
                        <p>The Generic Search API provides a flexible, unified endpoint for querying cache data. 
                           All requests use POST with a JSON body containing the search criteria and API key.</p>
                        
                        <h6 class="mt-3">Endpoint</h6>
                        <pre class="bg-dark text-light p-3 rounded"><code>POST /api/genericsearch
POST /api/v1/genericsearch
POST /api/v2/genericsearch</code></pre>

                        <h6 class="mt-3">Key Features (v2.2.0)</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <ul>
                                    <li>Single key or list of keys lookup</li>
                                    <li>Single or multiple regex patterns for keys</li>
                                    <li>API key in request body</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul>
                                    <li>Advanced JSON attribute search</li>
                                    <li>AND logic across all criteria</li>
                                    <li>Field projection support</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Request Format -->
                <div class="card mb-4" id="search-request">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0"><i class="fas fa-file-code me-2"></i>Request Format</h5>
                    </div>
                    <div class="card-body">
                        <pre class="bg-dark text-light p-3 rounded"><code>{
    "apiKey": "kub_your_api_key",      // Required: API key for authentication
    "region": "users",                  // Required: Region to search
    
    // Key Search (choose one or combine with JSON search)
    "key": "user:1001",                 // Mode 1: Single exact key
    "keys": ["user:1001", "user:1002"], // Mode 2: Multiple exact keys
    "keypattern": "user:\\d+",          // Mode 3: Single regex pattern
    "keypatterns": ["user_.*", "admin_.*"], // Mode 4: Multiple regex patterns
    
    // JSON Attribute Search
    "type": "json",                     // Enable JSON search
    "criteria": {                       // v2.1.0 format
        "status": "active",             // Equality match
        "role": ["admin", "manager"],   // IN operator (match any)
        "email": {"regex": ".*@company\\.com"}, // Regex match
        "age": {"gte": 18, "lte": 65}   // Range comparison
    },
    
    // Options
    "fields": ["name", "email"],        // Field projection
    "limit": 100                        // Max results (default: 1000)
}</code></pre>
                    </div>
                </div>

                <!-- Search Modes -->
                <div class="card mb-4">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0"><i class="fas fa-list me-2"></i>Search Modes</h5>
                    </div>
                    <div class="card-body">
                        <!-- Mode 1: Single Key -->
                        <h6 class="text-primary">Mode 1: Single Key Lookup</h6>
                        <p>Retrieve a specific key by exact match.</p>
                        <pre class="bg-dark text-light p-3 rounded"><code>{
    "apiKey": "kub_xxx",
    "region": "users",
    "key": "user:1001"
}</code></pre>

                        <!-- Mode 2: Multiple Keys -->
                        <h6 class="text-primary mt-4">Mode 2: Multiple Keys Lookup <span class="badge bg-success">NEW in v2.2.0</span></h6>
                        <p>Retrieve multiple specific keys at once.</p>
                        <pre class="bg-dark text-light p-3 rounded"><code>{
    "apiKey": "kub_xxx",
    "region": "users",
    "keys": ["user:1001", "user:1002", "user:1003"]
}</code></pre>

                        <!-- Mode 3: Single Pattern -->
                        <h6 class="text-primary mt-4">Mode 3: Single Key Pattern (Regex)</h6>
                        <p>Search keys matching a regex pattern.</p>
                        <pre class="bg-dark text-light p-3 rounded"><code>{
    "apiKey": "kub_xxx",
    "region": "users",
    "keypattern": "user:\\d{4}"
}</code></pre>

                        <!-- Mode 4: Multiple Patterns -->
                        <h6 class="text-primary mt-4">Mode 4: Multiple Key Patterns <span class="badge bg-success">NEW in v2.2.0</span></h6>
                        <p>Search keys matching any of multiple regex patterns (OR logic between patterns).</p>
                        <pre class="bg-dark text-light p-3 rounded"><code>{
    "apiKey": "kub_xxx",
    "region": "users",
    "keypatterns": ["user_.*", "admin_.*", "guest_.*"]
}</code></pre>

                        <!-- Mode 5: JSON Search -->
                        <h6 class="text-primary mt-4">Mode 5: JSON Attribute Search <span class="badge bg-success">Enhanced in v2.2.0</span></h6>
                        <p>Search JSON documents by attribute values. All criteria use AND logic.</p>
                        <pre class="bg-dark text-light p-3 rounded"><code>{
    "apiKey": "kub_xxx",
    "region": "users",
    "type": "json",
    "criteria": {
        "status": "active",
        "department": ["engineering", "sales"],
        "email": {"regex": ".*@company\\.com"}
    }
}</code></pre>
                    </div>
                </div>

                <!-- JSON Search Operators -->
                <div class="card mb-4">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0"><i class="fas fa-filter me-2"></i>JSON Search Operators</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Operator</th>
                                        <th>Syntax</th>
                                        <th>Description</th>
                                        <th>Example</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><code>equality</code></td>
                                        <td><code>"field": "value"</code></td>
                                        <td>Exact match</td>
                                        <td><code>"status": "active"</code></td>
                                    </tr>
                                    <tr>
                                        <td><code>in</code></td>
                                        <td><code>"field": [values]</code></td>
                                        <td>Match any value in list</td>
                                        <td><code>"role": ["admin", "user"]</code></td>
                                    </tr>
                                    <tr>
                                        <td><code>regex</code></td>
                                        <td><code>"field": {"regex": "pattern"}</code></td>
                                        <td>Regex pattern match</td>
                                        <td><code>"email": {"regex": ".*@gmail\\.com"}</code></td>
                                    </tr>
                                    <tr class="table-warning">
                                        <td><code>contains</code></td>
                                        <td><code>"field": {"contains": "substring"}</code></td>
                                        <td>Substring match <span class="badge bg-dark">v2.2.0</span></td>
                                        <td><code>"name": {"contains": "smith"}</code></td>
                                    </tr>
                                    <tr class="table-info">
                                        <td><code>prefix</code></td>
                                        <td><code>"field": {"prefix": "value"}</code></td>
                                        <td>Starts with <span class="badge bg-dark">v2.2.0</span></td>
                                        <td><code>"sku": {"prefix": "NYC-"}</code></td>
                                    </tr>
                                    <tr class="table-info">
                                        <td><code>startswith</code></td>
                                        <td><code>"field": {"startswith": "value"}</code></td>
                                        <td>Alias for prefix <span class="badge bg-dark">v2.2.0</span></td>
                                        <td><code>"phone": {"startswith": "+1"}</code></td>
                                    </tr>
                                    <tr>
                                        <td><code>gt</code></td>
                                        <td><code>"field": {"gt": value}</code></td>
                                        <td>Greater than</td>
                                        <td><code>"age": {"gt": 18}</code></td>
                                    </tr>
                                    <tr>
                                        <td><code>gte</code></td>
                                        <td><code>"field": {"gte": value}</code></td>
                                        <td>Greater than or equal</td>
                                        <td><code>"score": {"gte": 80}</code></td>
                                    </tr>
                                    <tr>
                                        <td><code>lt</code></td>
                                        <td><code>"field": {"lt": value}</code></td>
                                        <td>Less than</td>
                                        <td><code>"price": {"lt": 100}</code></td>
                                    </tr>
                                    <tr>
                                        <td><code>lte</code></td>
                                        <td><code>"field": {"lte": value}</code></td>
                                        <td>Less than or equal</td>
                                        <td><code>"quantity": {"lte": 50}</code></td>
                                    </tr>
                                    <tr>
                                        <td><code>ne</code></td>
                                        <td><code>"field": {"ne": value}</code></td>
                                        <td>Not equal</td>
                                        <td><code>"status": {"ne": "deleted"}</code></td>
                                    </tr>
                                    <tr>
                                        <td><code>range</code></td>
                                        <td><code>"field": {"gte": a, "lte": b}</code></td>
                                        <td>Combined range</td>
                                        <td><code>"age": {"gte": 18, "lte": 65}</code></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Combined Searches -->
                <div class="card mb-4">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0"><i class="fas fa-layer-group me-2"></i>Combined Searches</h5>
                    </div>
                    <div class="card-body">
                        <p>You can combine key patterns with JSON attribute search for powerful filtering:</p>
                        <pre class="bg-dark text-light p-3 rounded"><code>{
    "apiKey": "kub_xxx",
    "region": "orders",
    "keypatterns": ["order_2024.*"],
    "type": "json",
    "criteria": {
        "status": ["pending", "processing"],
        "total": {"gte": 100},
        "customer.country": "USA"
    },
    "fields": ["orderId", "status", "total", "customer.name"],
    "limit": 50
}</code></pre>
                        <p class="text-muted mt-2">
                            <i class="fas fa-info-circle me-1"></i>
                            This searches for orders from 2024 that are pending/processing, total >= $100, from USA customers.
                        </p>
                    </div>
                </div>

                <!-- Response Format -->
                <div class="card mb-4">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0"><i class="fas fa-reply me-2"></i>Response Format</h5>
                    </div>
                    <div class="card-body">
                        <p>Successful responses return an array of key-value pairs:</p>
                        <pre class="bg-dark text-light p-3 rounded"><code>[
    {
        "key": "user:1001",
        "value": {
            "name": "John Doe",
            "email": "john@example.com",
            "status": "active"
        }
    },
    {
        "key": "user:1002",
        "value": {
            "name": "Jane Smith",
            "email": "jane@example.com",
            "status": "active"
        }
    }
]</code></pre>

                        <h6 class="mt-4">Error Response</h6>
                        <pre class="bg-dark text-light p-3 rounded"><code>[
    {
        "error": "API key is required. Include 'apiKey' in request body."
    }
]</code></pre>
                    </div>
                </div>

                <!-- cURL Examples -->
                <div class="card mb-4">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0"><i class="fas fa-terminal me-2"></i>cURL Examples</h5>
                    </div>
                    <div class="card-body">
                        <h6>Single Key Lookup</h6>
                        <pre class="bg-dark text-light p-3 rounded"><code>curl -X POST http://localhost:8080/api/genericsearch \
  -H "Content-Type: application/json" \
  -d '{"apiKey":"kub_xxx","region":"users","key":"user:1001"}'</code></pre>

                        <h6 class="mt-4">Multiple Keys</h6>
                        <pre class="bg-dark text-light p-3 rounded"><code>curl -X POST http://localhost:8080/api/genericsearch \
  -H "Content-Type: application/json" \
  -d '{"apiKey":"kub_xxx","region":"users","keys":["user:1001","user:1002"]}'</code></pre>

                        <h6 class="mt-4">JSON Search with Criteria</h6>
                        <pre class="bg-dark text-light p-3 rounded"><code>curl -X POST http://localhost:8080/api/genericsearch \
  -H "Content-Type: application/json" \
  -d '{
    "apiKey": "kub_xxx",
    "region": "products",
    "type": "json",
    "criteria": {
        "category": ["electronics", "computers"],
        "price": {"lte": 500},
        "inStock": true
    }
  }'</code></pre>
                    </div>
                </div>

                <!-- Field Projection -->
                <div class="card mb-4">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0"><i class="fas fa-columns me-2"></i>Field Projection</h5>
                    </div>
                    <div class="card-body">
                        <p>Use the <code>fields</code> array to return only specific fields. Supports nested paths with dot notation.</p>
                        <pre class="bg-dark text-light p-3 rounded"><code>{
    "apiKey": "kub_xxx",
    "region": "users",
    "keypattern": "user:.*",
    "fields": ["name", "email", "address.city", "address.country"]
}</code></pre>
                        <p class="text-muted mt-2">
                            Returns only name, email, and nested address fields (city, country) for each result.
                        </p>
                    </div>
                </div>

                <!-- Parallel Search Performance -->
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Parallel Search (v2.2.0)</h5>
                    </div>
                    <div class="card-body">
                        <p>Both JSON searches and key pattern searches now use <strong>parallel processing</strong> for significantly improved performance on large datasets.</p>
                        
                        <h6 class="mt-3">Supported Parallel Search Types</h6>
                        <table class="table table-sm table-bordered">
                            <thead class="table-light">
                                <tr>
                                    <th>Search Type</th>
                                    <th>Parallel Strategy</th>
                                    <th>Benefit</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>JSON Criteria Search</strong></td>
                                    <td>Parallel document fetch + criteria matching</td>
                                    <td>~8x speedup</td>
                                </tr>
                                <tr>
                                    <td><strong>Single Pattern Search</strong></td>
                                    <td>Phase 1: Parallel key matching<br>Phase 2: Parallel value fetching</td>
                                    <td>~4-6x speedup</td>
                                </tr>
                                <tr>
                                    <td><strong>Multi-Pattern Search</strong></td>
                                    <td>Parallel pattern evaluation + value fetching</td>
                                    <td>~4-6x speedup</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <h6 class="mt-3">Performance Gains (JSON Search)</h6>
                        <table class="table table-sm table-bordered">
                            <thead class="table-light">
                                <tr>
                                    <th>Dataset Size</th>
                                    <th>Sequential</th>
                                    <th>Parallel (8 threads)</th>
                                    <th>Speedup</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>1,000 keys</td><td>85ms</td><td>82ms</td><td>~1x</td></tr>
                                <tr><td>10,000 keys</td><td>840ms</td><td>125ms</td><td>~6.7x</td></tr>
                                <tr><td>50,000 keys</td><td>4,200ms</td><td>580ms</td><td>~7.2x</td></tr>
                                <tr class="table-success"><td>100,000 keys</td><td>8,450ms</td><td>1,050ms</td><td><strong>~8x</strong></td></tr>
                            </tbody>
                        </table>
                        
                        <h6 class="mt-3">Two-Phase Pattern Search</h6>
                        <p>Pattern searches use an optimized two-phase approach:</p>
                        <pre class="bg-dark text-light p-3 rounded"><code>Phase 1: Parallel Key Matching (CPU-bound, fast)
───────────────────────────────────────────────
  Thread 1: [Keys 0-25000]     → Match patterns → Matched keys
  Thread 2: [Keys 25001-50000] → Match patterns → Matched keys
  Thread 3: [Keys 50001-75000] → Match patterns → Matched keys
  Thread 4: [Keys 75001-100000]→ Match patterns → Matched keys

Phase 2: Parallel Value Fetching (I/O-bound)
───────────────────────────────────────────────
  Thread 1: [Matched 0-250]     → Fetch values
  Thread 2: [Matched 251-500]   → Fetch values
  Thread 3: [Matched 501-750]   → Fetch values
  Thread 4: [Matched 751-1000]  → Fetch values</code></pre>
                        
                        <h6 class="mt-3">How It Works</h6>
                        <ul>
                            <li><strong>Auto Mode Selection</strong>: For &lt;1000 keys, sequential search is used (parallel overhead not worth it). For larger datasets, parallel search is automatically enabled.</li>
                            <li><strong>Thread Pool</strong>: A dedicated thread pool (default 8 threads) processes key partitions concurrently.</li>
                            <li><strong>Early Termination</strong>: When the result limit is reached, all threads are signaled to stop immediately.</li>
                            <li><strong>Regex Caching</strong>: Compiled regex patterns are cached for repeated searches.</li>
                        </ul>
                        
                        <h6 class="mt-3">Configuration</h6>
                        <pre class="bg-dark text-light p-3 rounded"><code># application.properties
kuber.search.parallel-enabled=true     # Enable/disable parallel search (default: true)
kuber.search.thread-count=8            # Number of threads (default: 8, 0=auto)
kuber.search.parallel-threshold=1000   # Min keys for parallel mode (default: 1000)
kuber.search.timeout-seconds=60        # Search timeout (default: 60s)</code></pre>
                        
                        <h6 class="mt-3">Search Statistics API</h6>
                        <p>Monitor search performance with the statistics endpoint:</p>
                        <pre class="bg-dark text-light p-3 rounded"><code>GET /api/search/stats

Response:
{
    "totalSearches": 1523,
    "parallelSearches": 892,
    "sequentialSearches": 631,
    "jsonSearches": 1100,
    "patternSearches": 423,
    "totalSearchTimeMs": 45230,
    "avgSearchTimeMs": 29,
    "parallelSearchPercent": "58.6%",
    "parallelEnabled": true,
    "threadCount": 8,
    "parallelThreshold": 1000,
    "cachedRegexPatterns": 15
}</code></pre>
                    </div>
                </div>

                <!-- Secondary Indexing Performance -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-list-alt me-2"></i>Secondary Indexing (v2.2.0)</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-success">
                            <i class="fas fa-rocket me-2"></i>
                            <strong>Up to 1,000x faster!</strong> Secondary indexes provide O(1) hash lookups, O(log n) 
                            range queries, and <strong>TRIGRAM indexes for regex/pattern searches</strong> instead of O(n) full table scans.
                        </div>
                        
                        <h6 class="mt-3">Performance with Indexes</h6>
                        <table class="table table-sm table-bordered">
                            <thead class="table-dark">
                                <tr>
                                    <th>Query</th>
                                    <th>Without Index</th>
                                    <th>With Index</th>
                                    <th>Speedup</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>status = "active"</code></td>
                                    <td>8,450ms</td>
                                    <td>5ms</td>
                                    <td class="table-success"><strong>1,690x</strong></td>
                                </tr>
                                <tr>
                                    <td><code>age &gt; 30</code></td>
                                    <td>8,450ms</td>
                                    <td>45ms</td>
                                    <td class="table-success"><strong>188x</strong></td>
                                </tr>
                                <tr>
                                    <td><code>status = "active" AND city = "NYC"</code></td>
                                    <td>8,450ms</td>
                                    <td>12ms</td>
                                    <td class="table-success"><strong>704x</strong></td>
                                </tr>
                                <tr class="table-warning">
                                    <td><code>email REGEX ".*@gmail\.com$"</code></td>
                                    <td>8,450ms</td>
                                    <td>8ms (TRIGRAM)</td>
                                    <td class="table-success"><strong>1,056x</strong></td>
                                </tr>
                                <tr class="table-warning">
                                    <td><code>name CONTAINS "smith"</code></td>
                                    <td>8,450ms</td>
                                    <td>12ms (TRIGRAM)</td>
                                    <td class="table-success"><strong>704x</strong></td>
                                </tr>
                            </tbody>
                        </table>
                        <p class="small text-muted">* 100,000 JSON documents benchmark</p>
                        
                        <h6 class="mt-3">Index Types</h6>
                        <div class="row">
                            <div class="col-md-6 mb-2">
                                <div class="card border-primary">
                                    <div class="card-header bg-primary text-white py-2">HASH Index</div>
                                    <div class="card-body py-2">
                                        <p class="small mb-1"><strong>O(1) lookup</strong></p>
                                        <p class="small mb-0">Best for: <code>status = "active"</code>, <code>city IN [...]</code></p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-2">
                                <div class="card border-success">
                                    <div class="card-header bg-success text-white py-2">BTREE Index</div>
                                    <div class="card-body py-2">
                                        <p class="small mb-1"><strong>O(log n) lookup</strong></p>
                                        <p class="small mb-0">Best for: <code>age &gt; 30</code>, <code>date BETWEEN</code></p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-2">
                                <div class="card border-warning">
                                    <div class="card-header bg-warning text-dark py-2">TRIGRAM Index <span class="badge bg-dark ms-1">v2.2.0</span></div>
                                    <div class="card-body py-2">
                                        <p class="small mb-1"><strong>Accelerates regex/pattern searches</strong></p>
                                        <p class="small mb-0">Best for: <code>email {"regex": ".*@gmail\\.com"}</code>, <code>{"contains": "smith"}</code></p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-2">
                                <div class="card border-info">
                                    <div class="card-header bg-info text-white py-2">PREFIX Index <span class="badge bg-light text-dark ms-1">v2.2.0</span></div>
                                    <div class="card-body py-2">
                                        <p class="small mb-1"><strong>O(prefix len) lookup</strong></p>
                                        <p class="small mb-0">Best for: <code>{"prefix": "NYC-"}</code>, <code>{"startswith": "+1-212"}</code></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="alert alert-warning mt-3 small">
                            <i class="fas fa-lightbulb me-2"></i>
                            <strong>Tip:</strong> Create a <strong>TRIGRAM</strong> index on any field where you use <code>regex</code>, 
                            <code>contains</code>, or <code>prefix</code> operators. The index extracts literals from your regex pattern 
                            and uses trigram lookups to find candidates, avoiding full table scans.
                            <a href="/help/secondary-indexing" class="fw-bold">Learn more →</a>
                        </div>
                        
                        <h6 class="mt-3">Configure Indexes</h6>
                        <p>Define indexes in <code>config/index.yaml</code>:</p>
                        <pre class="bg-dark text-light p-3 rounded"><code>regions:
  customers:
    indexes:
      - field: status
        type: hash
      - field: age
        type: btree
      - field: email
        type: trigram        # NEW: Accelerates regex searches
      - field: name
        type: trigram        # NEW: Accelerates contains/substring
      - field: status,city    # Composite
        type: hash</code></pre>
                        
                        <div class="mt-3">
                            <a href="/help/secondary-indexing" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-book me-1"></i>Full Indexing Documentation
                            </a>
                            <a href="/admin/indexes" class="btn btn-sm btn-outline-secondary ms-2">
                                <i class="fas fa-cog me-1"></i>Manage Indexes
                            </a>
                        </div>
                    </div>
                </div>

                <!-- ========================================== -->
                <!-- UPDATE API SECTION                         -->
                <!-- ========================================== -->
                <h2 class="border-bottom pb-2 mb-4 mt-5" id="update-overview"><i class="fas fa-edit me-2 text-warning"></i>Generic Update API</h2>

                <!-- Update Overview -->
                <div class="card mb-4">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Overview</h5>
                    </div>
                    <div class="card-body">
                        <p>The Generic Update API provides a unified endpoint for creating and updating cache entries.
                           When updating JSON data, it intelligently merges new values with existing data using JUPDATE logic.</p>
                        
                        <h6 class="mt-3">Endpoint</h6>
                        <pre class="bg-dark text-light p-3 rounded"><code>POST /api/genericupdate
POST /api/v1/genericupdate
POST /api/v2/genericupdate</code></pre>

                        <h6 class="mt-3">Key Features</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <ul>
                                    <li>Create new entries with any value type</li>
                                    <li>Replace existing values entirely</li>
                                    <li>Smart JSON merging with JUPDATE</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul>
                                    <li>Deep merge for nested objects</li>
                                    <li>Optional TTL support</li>
                                    <li>Auto-create regions if not exist</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Update Request Format -->
                <div class="card mb-4" id="update-request">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="fas fa-file-code me-2"></i>Request Format</h5>
                    </div>
                    <div class="card-body">
                        <pre class="bg-dark text-light p-3 rounded"><code>{
    "apiKey": "kub_your_api_key",      // Required: API key for authentication
    "region": "users",                  // Required: Target region (auto-created if needed)
    "key": "user:123",                  // Required: Cache key to set/update
    "value": {...},                     // Required: Value (object, array, or scalar)
    "type": "json",                     // Optional: Set to "json" for merge semantics
    "ttl": 3600                         // Optional: TTL in seconds (-1 = no expiry)
}</code></pre>

                        <h6 class="mt-3">Request Parameters</h6>
                        <table class="table table-bordered table-sm">
                            <thead class="table-light">
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>apiKey</code></td>
                                    <td>string</td>
                                    <td><span class="badge bg-danger">Yes</span></td>
                                    <td>API key for authentication (starts with <code>kub_</code>)</td>
                                </tr>
                                <tr>
                                    <td><code>region</code></td>
                                    <td>string</td>
                                    <td><span class="badge bg-danger">Yes</span></td>
                                    <td>Target region name (auto-created if doesn't exist)</td>
                                </tr>
                                <tr>
                                    <td><code>key</code></td>
                                    <td>string</td>
                                    <td><span class="badge bg-danger">Yes</span></td>
                                    <td>Cache key to create or update</td>
                                </tr>
                                <tr>
                                    <td><code>value</code></td>
                                    <td>any</td>
                                    <td><span class="badge bg-danger">Yes</span></td>
                                    <td>Value to set (object, array, string, number, boolean)</td>
                                </tr>
                                <tr>
                                    <td><code>type</code></td>
                                    <td>string</td>
                                    <td><span class="badge bg-secondary">No</span></td>
                                    <td>Set to <code>"json"</code> for JSON merge semantics</td>
                                </tr>
                                <tr>
                                    <td><code>ttl</code></td>
                                    <td>number</td>
                                    <td><span class="badge bg-secondary">No</span></td>
                                    <td>Time-to-live in seconds (default: -1 = no expiry)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Merge Behavior -->
                <div class="card mb-4" id="update-merge">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="fas fa-cogs me-2"></i>Behavior &amp; Smart Merge</h5>
                    </div>
                    <div class="card-body">
                        <h6>Operation Logic</h6>
                        <table class="table table-bordered table-sm">
                            <thead class="table-light">
                                <tr>
                                    <th>Key Exists?</th>
                                    <th>Type</th>
                                    <th>Action</th>
                                    <th>Result</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><span class="badge bg-secondary">No</span></td>
                                    <td>any</td>
                                    <td><strong>CREATE</strong></td>
                                    <td>New entry created with given value</td>
                                </tr>
                                <tr>
                                    <td><span class="badge bg-success">Yes</span></td>
                                    <td>not "json"</td>
                                    <td><strong>REPLACE</strong></td>
                                    <td>Value replaced entirely</td>
                                </tr>
                                <tr>
                                    <td><span class="badge bg-success">Yes</span></td>
                                    <td>"json"</td>
                                    <td><strong>MERGE</strong></td>
                                    <td>Values merged using JUPDATE logic</td>
                                </tr>
                            </tbody>
                        </table>

                        <h6 class="mt-4">JUPDATE Merge Logic</h6>
                        <p>When <code>type="json"</code> and key exists, the following merge rules apply:</p>
                        <ul>
                            <li><strong>Existing fields not in request</strong> → <span class="text-success">Preserved</span></li>
                            <li><strong>Fields in both</strong> → <span class="text-warning">Overwritten with new value</span></li>
                            <li><strong>New fields in request</strong> → <span class="text-primary">Added</span></li>
                            <li><strong>Nested objects</strong> → <span class="text-info">Deep merged recursively</span></li>
                            <li><strong>Arrays</strong> → <span class="text-danger">Replaced entirely (not merged)</span></li>
                        </ul>
                    </div>
                </div>

                <!-- Update Examples -->
                <div class="card mb-4" id="update-examples">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="fas fa-code me-2"></i>Update Examples</h5>
                    </div>
                    <div class="card-body">
                        <!-- Example 1: Create -->
                        <h6><i class="fas fa-plus-circle text-success me-2"></i>Example 1: Create New Entry</h6>
                        <pre class="bg-dark text-light p-3 rounded"><code>curl -X POST http://localhost:8080/api/genericupdate \
  -H "Content-Type: application/json" \
  -d '{
    "apiKey": "kub_xxxxx",
    "region": "users",
    "key": "user:1",
    "value": {"name": "John Doe", "email": "john@example.com", "age": 30},
    "type": "json",
    "ttl": 86400
  }'</code></pre>
                        <p class="small text-muted">Response: <code>{"success":true, "operation":"created", ...}</code></p>

                        <!-- Example 2: Merge -->
                        <h6 class="mt-4"><i class="fas fa-object-group text-primary me-2"></i>Example 2: Merge/Update JSON</h6>
                        <p class="small text-muted">Existing value: <code>{"name": "John Doe", "email": "john@example.com", "age": 30}</code></p>
                        <pre class="bg-dark text-light p-3 rounded"><code>curl -X POST http://localhost:8080/api/genericupdate \
  -H "Content-Type: application/json" \
  -d '{
    "apiKey": "kub_xxxxx",
    "region": "users",
    "key": "user:1",
    "value": {"email": "john.new@example.com", "city": "NYC", "verified": true},
    "type": "json"
  }'</code></pre>
                        <p class="small text-muted">Result: <code>{"name": "John Doe", "email": "john.new@example.com", "age": 30, "city": "NYC", "verified": true}</code></p>

                        <!-- Example 3: Deep Merge -->
                        <h6 class="mt-4"><i class="fas fa-layer-group text-info me-2"></i>Example 3: Deep Merge Nested Objects</h6>
                        <p class="small text-muted">Existing value:</p>
                        <pre class="bg-light p-2 rounded small"><code>{"profile": {"name": "John", "settings": {"theme": "dark", "notifications": true}}, "lastLogin": "2025-01-01"}</code></pre>
                        <pre class="bg-dark text-light p-3 rounded"><code>curl -X POST http://localhost:8080/api/genericupdate \
  -H "Content-Type: application/json" \
  -d '{
    "apiKey": "kub_xxxxx",
    "region": "users",
    "key": "user:1",
    "value": {"profile": {"settings": {"theme": "light", "language": "en"}}},
    "type": "json"
  }'</code></pre>
                        <p class="small text-muted">Result (deep merged):</p>
                        <pre class="bg-light p-2 rounded small"><code>{"profile": {"name": "John", "settings": {"theme": "light", "notifications": true, "language": "en"}}, "lastLogin": "2025-01-01"}</code></pre>
                    </div>
                </div>

                <!-- Update Response -->
                <div class="card mb-4">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="fas fa-reply me-2"></i>Update Response Format</h5>
                    </div>
                    <div class="card-body">
                        <h6>Success Response</h6>
                        <pre class="bg-dark text-light p-3 rounded"><code>{
    "success": true,
    "operation": "created",      // "created", "replaced", or "merged"
    "region": "users",
    "key": "user:123",
    "value": {...},              // The resulting value after operation
    "ttl": 3600                  // Only if TTL was set
}</code></pre>

                        <h6 class="mt-3">Operation Values</h6>
                        <table class="table table-bordered table-sm">
                            <thead class="table-light">
                                <tr>
                                    <th>Operation</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>created</code></td>
                                    <td>New entry was created (key didn't exist)</td>
                                </tr>
                                <tr>
                                    <td><code>replaced</code></td>
                                    <td>Existing value was replaced entirely (non-JSON type)</td>
                                </tr>
                                <tr>
                                    <td><code>merged</code></td>
                                    <td>Existing JSON was merged with new values (type="json")</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Best Practices -->
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="fas fa-lightbulb me-2"></i>Best Practices</h5>
                    </div>
                    <div class="card-body">
                        <ul>
                            <li><strong>Use JSON Type for Partial Updates:</strong> When you only need to update specific fields, use <code>type: "json"</code> to merge instead of replacing the entire document.</li>
                            <li><strong>Set Appropriate TTLs:</strong> Use TTL for session data, caches, and temporary values. Omit TTL for permanent data.</li>
                            <li><strong>Check Operation Result:</strong> The <code>operation</code> field tells you what happened: <code>created</code>, <code>replaced</code>, or <code>merged</code>.</li>
                            <li><strong>Combine Search + Update:</strong> Use <code>/api/genericsearch</code> to find entries and <code>/api/genericupdate</code> to modify them.</li>
                        </ul>
                    </div>
                </div>

                <!-- Back Button -->
                <div class="mt-5 text-center">
                    <a href="/help" class="btn btn-outline-primary">
                        <i class="fas fa-arrow-left me-2"></i>Back to Help Index
                    </a>
                    <a href="/help/rest-api" class="btn btn-outline-secondary ms-2">
                        <i class="fas fa-code me-2"></i>REST API
                    </a>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="py-4 mt-5 border-top">
            <div class="row">
                <div class="col-md-6">
                    <h6><i class="fas fa-database me-2"></i><span th:text="${appName} ?: 'Kuber'">Kuber</span> Distributed Cache</h6>
                    <p class="text-muted small mb-0">Version 2.6.0</p>
                </div>
                <div class="col-md-6 text-end">
                    <p class="text-muted small mb-0">
                        Copyright &copy; 2025-2030, All Rights Reserved<br>
                        Ashutosh Sinha | <a href="mailto:ajsinha@gmail.com">ajsinha@gmail.com</a><br>
                        <span class="badge bg-warning text-dark">Patent Pending</span>
                    </p>
                </div>
            </div>
        </footer>
    </div>
</main>

<footer th:replace="~{layout :: footer}"></footer>
<th:block th:replace="~{layout :: scripts}"></th:block>

</body>
</html>
