<!DOCTYPE html>
<!--
  ~ Copyright (c) 2025-2030, All Rights Reserved
  ~ Ashutosh Sinha | Email: ajsinha@gmail.com
  ~ Kuber v1.9.0 - Security & RBAC Help
  -->
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head('Security & RBAC')}"></head>
<body class="d-flex flex-column min-vh-100">
<nav th:replace="~{layout :: navbar}"></nav>

<main class="flex-fill">
<div class="container-fluid py-4">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/help"><i class="fas fa-book me-1"></i>Help</a></li>
            <li class="breadcrumb-item active" aria-current="page">Security &amp; RBAC</li>
        </ol>
    </nav>
    
    <h1 class="mb-4"><i class="fas fa-shield-alt text-primary me-2"></i>Security &amp; Role-Based Access Control</h1>
    
    <div class="alert alert-info">
        <i class="fas fa-info-circle me-2"></i>
        <strong>v1.9.0</strong> introduces enterprise-grade Role-Based Access Control (RBAC) for fine-grained authorization.
    </div>

    <!-- Table of Contents -->
    <div class="card mb-4">
        <div class="card-header bg-light">
            <h5 class="mb-0"><i class="fas fa-list me-2"></i>Contents</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <ul class="list-unstyled">
                        <li><a href="#overview">Overview</a></li>
                        <li><a href="#permissions">Permission Types</a></li>
                        <li><a href="#roles">Roles &amp; Role Patterns</a></li>
                        <li><a href="#users">Users &amp; Role Assignment</a></li>
                        <li><a href="#auth-flow">Authorization Flow</a></li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <ul class="list-unstyled">
                        <li><a href="#config">Configuration</a></li>
                        <li><a href="#hot-reload">Hot Reload &amp; Defaults</a></li>
                        <li><a href="#examples">Practical Examples</a></li>
                        <li><a href="#api-auth">API Authentication</a></li>
                        <li><a href="#errors">Error Messages</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Overview -->
    <div class="card mb-4" id="overview">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="fas fa-eye me-2"></i>Overview</h5>
        </div>
        <div class="card-body">
            <p>Kuber implements a comprehensive security model with two layers:</p>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="card bg-light h-100">
                        <div class="card-body">
                            <h6><i class="fas fa-sign-in-alt text-primary me-2"></i>Authentication</h6>
                            <p class="mb-0">Verifies <em>who</em> the user is:</p>
                            <ul class="mb-0">
                                <li>Form login (Web UI)</li>
                                <li>HTTP Basic (REST API)</li>
                                <li>API Key (Redis protocol &amp; REST)</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card bg-light h-100">
                        <div class="card-body">
                            <h6><i class="fas fa-lock text-success me-2"></i>Authorization (RBAC)</h6>
                            <p class="mb-0">Controls <em>what</em> users can do:</p>
                            <ul class="mb-0">
                                <li>Role-based permissions</li>
                                <li>Region-specific access</li>
                                <li>Operation-level control</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="alert alert-warning mt-3 mb-0">
                <i class="fas fa-shield-alt me-2"></i>
                <strong>Admin Protection:</strong> The <code>admin</code> user and <code>admin</code> role are reserved and cannot be deleted or have their permissions modified.
            </div>
        </div>
    </div>

    <!-- Permission Types -->
    <div class="card mb-4" id="permissions">
        <div class="card-header"><h5 class="mb-0"><i class="fas fa-key me-2"></i>Permission Types</h5></div>
        <div class="card-body">
            <p>Kuber defines four permission levels that control access to cache operations:</p>
            
            <table class="table table-bordered">
                <thead class="table-light">
                    <tr><th style="width:120px">Permission</th><th>Redis/REST Operations</th><th>Description</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="badge bg-success fs-6">READ</span></td>
                        <td>
                            <code>GET</code>, <code>MGET</code>, <code>EXISTS</code>, <code>KEYS</code>, <code>SCAN</code>, 
                            <code>TYPE</code>, <code>TTL</code>, <code>DBSIZE</code>, <code>JSEARCH</code>, <code>JGET</code>, 
                            <code>HGET</code>, <code>HGETALL</code>, <code>HKEYS</code>, <code>HLEN</code>
                        </td>
                        <td>Read and search data from cache</td>
                    </tr>
                    <tr>
                        <td><span class="badge bg-warning text-dark fs-6">WRITE</span></td>
                        <td>
                            <code>SET</code>, <code>MSET</code>, <code>SETEX</code>, <code>SETNX</code>, <code>APPEND</code>,
                            <code>INCR</code>, <code>INCRBY</code>, <code>DECR</code>, <code>DECRBY</code>,
                            <code>HSET</code>, <code>HMSET</code>, <code>HINCRBY</code>,
                            <code>JSET</code>, <code>JUPDATE</code>, <code>JREMOVE</code>, <code>EXPIRE</code>
                        </td>
                        <td>Create and update data in cache</td>
                    </tr>
                    <tr>
                        <td><span class="badge bg-danger fs-6">DELETE</span></td>
                        <td>
                            <code>DEL</code>, <code>HDEL</code>, <code>JDEL</code>, 
                            <code>RPURGE</code>, <code>FLUSHDB</code>
                        </td>
                        <td>Delete data and purge regions</td>
                    </tr>
                    <tr>
                        <td><span class="badge bg-dark fs-6">ADMIN</span></td>
                        <td>
                            <code>RCREATE</code>, <code>RDROP</code>, <code>RLIST</code>,
                            User Management, Role Management, API Key Management
                        </td>
                        <td>Administrative and region management operations</td>
                    </tr>
                </tbody>
            </table>
            
            <div class="alert alert-info mb-0">
                <i class="fas fa-info-circle me-2"></i>
                <strong>Note:</strong> The <code>ADMIN</code> permission implicitly includes all other permissions (READ, WRITE, DELETE).
            </div>
        </div>
    </div>

    <!-- Role Structure -->
    <div class="card mb-4" id="roles">
        <div class="card-header"><h5 class="mb-0"><i class="fas fa-user-tag me-2"></i>Roles &amp; Role Patterns</h5></div>
        <div class="card-body">
            <h6>Role Properties</h6>
            <table class="table table-sm table-bordered">
                <thead class="table-light">
                    <tr><th>Property</th><th>Required</th><th>Description</th></tr>
                </thead>
                <tbody>
                    <tr><td><code>name</code></td><td>Yes</td><td>Unique identifier (e.g., <code>orders_readonly</code>)</td></tr>
                    <tr><td><code>displayName</code></td><td>No</td><td>Human-readable name for UI display</td></tr>
                    <tr><td><code>description</code></td><td>No</td><td>Detailed description of role purpose</td></tr>
                    <tr><td><code>region</code></td><td>Yes</td><td>Region name or <code>*</code> for all regions</td></tr>
                    <tr><td><code>permissions</code></td><td>Yes</td><td>Array: <code>["READ"]</code>, <code>["READ", "WRITE"]</code>, etc.</td></tr>
                    <tr><td><code>systemRole</code></td><td>No</td><td>If true, cannot be deleted (default: false)</td></tr>
                    <tr><td><code>active</code></td><td>No</td><td>If false, role is ignored (default: true)</td></tr>
                </tbody>
            </table>
            
            <h6 class="mt-4">Standard Naming Conventions</h6>
            <p>Follow these patterns for consistent role naming:</p>
            <table class="table table-sm">
                <thead class="table-light">
                    <tr><th>Pattern</th><th>Permissions</th><th>Example</th></tr>
                </thead>
                <tbody>
                    <tr><td><code>admin</code></td><td>READ, WRITE, DELETE, ADMIN</td><td>Full system access (reserved)</td></tr>
                    <tr><td><code>{region}_readonly</code></td><td>READ</td><td><code>orders_readonly</code></td></tr>
                    <tr><td><code>{region}_readwrite</code></td><td>READ, WRITE</td><td><code>orders_readwrite</code></td></tr>
                    <tr><td><code>{region}_full</code></td><td>READ, WRITE, DELETE</td><td><code>orders_full</code></td></tr>
                </tbody>
            </table>
            
            <h6 class="mt-4">Example roles.json</h6>
            <pre class="bg-dark text-light p-3 rounded"><code>{
  "roles": [
    {
      "name": "admin",
      "displayName": "System Administrator",
      "description": "Full system access to all regions and admin operations",
      "region": "*",
      "permissions": ["READ", "WRITE", "DELETE", "ADMIN"],
      "systemRole": true,
      "active": true
    },
    {
      "name": "default_readonly",
      "displayName": "Default Read Only",
      "description": "Read-only access to the default region",
      "region": "default",
      "permissions": ["READ"],
      "active": true
    },
    {
      "name": "orders_readwrite",
      "displayName": "Orders Read/Write",
      "description": "Read and write access to orders region",
      "region": "orders",
      "permissions": ["READ", "WRITE"],
      "active": true
    },
    {
      "name": "orders_full",
      "displayName": "Orders Full Access",
      "description": "Full access to orders region including delete",
      "region": "orders",
      "permissions": ["READ", "WRITE", "DELETE"],
      "active": true
    }
  ]
}</code></pre>
        </div>
    </div>

    <!-- User Structure -->
    <div class="card mb-4" id="users">
        <div class="card-header"><h5 class="mb-0"><i class="fas fa-users me-2"></i>Users &amp; Role Assignment</h5></div>
        <div class="card-body">
            <h6>User Properties</h6>
            <table class="table table-sm table-bordered">
                <thead class="table-light">
                    <tr><th>Property</th><th>Required</th><th>Description</th></tr>
                </thead>
                <tbody>
                    <tr><td><code>userId</code></td><td>Yes</td><td>Unique login identifier</td></tr>
                    <tr><td><code>password</code></td><td>Yes</td><td>Authentication password (cleartext)</td></tr>
                    <tr><td><code>fullName</code></td><td>Yes</td><td>Display name for UI</td></tr>
                    <tr><td><code>email</code></td><td>No</td><td>User's email address</td></tr>
                    <tr><td><code>roles</code></td><td>Yes</td><td>Array of role names assigned to user</td></tr>
                    <tr><td><code>enabled</code></td><td>No</td><td>Account active (default: true)</td></tr>
                    <tr><td><code>locked</code></td><td>No</td><td>Account locked (default: false)</td></tr>
                    <tr><td><code>systemUser</code></td><td>No</td><td>Cannot be deleted (default: false)</td></tr>
                </tbody>
            </table>
            
            <h6 class="mt-4">Effective Permissions</h6>
            <p>A user's effective permissions for a region are the <strong>union</strong> of all permissions from their assigned roles:</p>
            
            <div class="card bg-light mb-3">
                <div class="card-body">
                    <p class="mb-2"><strong>Example:</strong> User with roles <code>["orders_readonly", "products_full"]</code></p>
                    <ul class="mb-0">
                        <li><code>orders</code> region: READ</li>
                        <li><code>products</code> region: READ, WRITE, DELETE</li>
                        <li>Other regions: No access</li>
                    </ul>
                </div>
            </div>
            
            <h6 class="mt-4">Example users.json</h6>
            <pre class="bg-dark text-light p-3 rounded"><code>{
  "users": [
    {
      "userId": "admin",
      "password": "admin123",
      "fullName": "System Administrator",
      "email": "admin@example.com",
      "roles": ["admin"],
      "enabled": true,
      "systemUser": true
    },
    {
      "userId": "order_service",
      "password": "order_svc_2025",
      "fullName": "Order Processing Service",
      "email": "orders@example.com",
      "roles": ["orders_full", "products_readonly", "inventory_readwrite"],
      "enabled": true
    },
    {
      "userId": "analytics",
      "password": "analytics_2025",
      "fullName": "Analytics Dashboard",
      "email": "analytics@example.com",
      "roles": ["default_readonly", "orders_readonly", "products_readonly"],
      "enabled": true
    },
    {
      "userId": "developer",
      "password": "dev123",
      "fullName": "Development User",
      "email": "dev@example.com",
      "roles": ["default_readwrite", "test_full"],
      "enabled": true
    }
  ]
}</code></pre>
        </div>
    </div>

    <!-- Authorization Flow -->
    <div class="card mb-4" id="auth-flow">
        <div class="card-header"><h5 class="mb-0"><i class="fas fa-project-diagram me-2"></i>Authorization Flow</h5></div>
        <div class="card-body">
            <div class="row">
                <div class="col-lg-6">
                    <h6>Permission Check Process</h6>
                    <ol>
                        <li><strong>Authentication:</strong> User identity verified (login, API key, basic auth)</li>
                        <li><strong>Load Roles:</strong> User's assigned roles retrieved from users.json</li>
                        <li><strong>Check Permission:</strong> For each operation:
                            <ul>
                                <li>Determine required permission (READ/WRITE/DELETE/ADMIN)</li>
                                <li>Determine target region</li>
                                <li>Check if any role grants permission for that region</li>
                            </ul>
                        </li>
                        <li><strong>Allow/Deny:</strong> Operation proceeds if permitted, error returned if denied</li>
                    </ol>
                </div>
                <div class="col-lg-6">
                    <h6>Flow Diagram</h6>
                    <pre class="bg-light p-3 rounded small">
┌─────────────────┐
│   User Request  │
└────────┬────────┘
         ▼
┌─────────────────┐
│  Authenticate   │
│ (API Key/Login) │
└────────┬────────┘
         ▼
┌─────────────────┐     ┌─────────────┐
│  Is Admin User? │──Yes──▶│ Allow All   │
└────────┬────────┘     └─────────────┘
         │No
         ▼
┌─────────────────┐
│  Get User Roles │
└────────┬────────┘
         ▼
┌─────────────────┐     ┌─────────────┐
│ Role Grants     │──Yes──▶│   Allow     │
│ Permission?     │     └─────────────┘
└────────┬────────┘
         │No
         ▼
┌─────────────────┐
│  Access Denied  │
│ (NOPERM error)  │
└─────────────────┘</pre>
                </div>
            </div>
            
            <div class="alert alert-success mt-3 mb-0">
                <i class="fas fa-bolt me-2"></i>
                <strong>Admin Bypass:</strong> Users with the <code>admin</code> role bypass all permission checks and have full access to everything.
            </div>
        </div>
    </div>

    <!-- Configuration -->
    <div class="card mb-4" id="config">
        <div class="card-header"><h5 class="mb-0"><i class="fas fa-cog me-2"></i>Configuration</h5></div>
        <div class="card-body">
            <h6>File Locations</h6>
            <p>Security files are stored in the <code>secure/</code> folder:</p>
            <pre class="bg-light p-3 rounded">secure/
├── users.json       # User accounts and role assignments
├── roles.json       # Role definitions and permissions
└── apikeys.json     # API keys for programmatic access</pre>
            
            <h6 class="mt-4">application.properties</h6>
            <pre class="bg-dark text-light p-3 rounded"><code># Secure folder location
kuber.secure.folder=secure

# Security file paths
kuber.security.users-file=${kuber.secure.folder}/users.json
kuber.security.roles-file=${kuber.secure.folder}/roles.json
kuber.security.api-keys-file=${kuber.secure.folder}/apikeys.json

# RBAC settings
kuber.security.rbac-enabled=true
kuber.security.auto-create-region-roles=true</code></pre>
            
            <h6 class="mt-4">Configuration Properties</h6>
            <table class="table table-sm table-bordered">
                <thead class="table-light">
                    <tr><th>Property</th><th>Default</th><th>Description</th></tr>
                </thead>
                <tbody>
                    <tr><td><code>kuber.secure.folder</code></td><td><code>secure</code></td><td>Folder for security configuration files</td></tr>
                    <tr><td><code>kuber.security.users-file</code></td><td><code>${kuber.secure.folder}/users.json</code></td><td>Path to users configuration</td></tr>
                    <tr><td><code>kuber.security.roles-file</code></td><td><code>${kuber.secure.folder}/roles.json</code></td><td>Path to roles configuration</td></tr>
                    <tr><td><code>kuber.security.rbac-enabled</code></td><td><code>true</code></td><td>Enable/disable RBAC enforcement</td></tr>
                    <tr><td><code>kuber.security.auto-create-region-roles</code></td><td><code>true</code></td><td>Auto-create roles when regions are created</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Hot Reload -->
    <div class="card mb-4" id="hot-reload">
        <div class="card-header"><h5 class="mb-0"><i class="fas fa-sync me-2"></i>Hot Reload &amp; Default Files</h5></div>
        <div class="card-body">
            <h6>Automatic Configuration Reload</h6>
            <div class="row mb-3">
                <div class="col-md-6">
                    <div class="card bg-light h-100">
                        <div class="card-body">
                            <h6 class="text-success"><i class="fas fa-check-circle me-2"></i>Linked Reload</h6>
                            <p class="mb-0">When <strong>either</strong> <code>users.json</code> <strong>OR</strong> <code>roles.json</code> changes, <strong>BOTH</strong> files are reloaded together to ensure consistency.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card bg-light h-100">
                        <div class="card-body">
                            <h6 class="text-primary"><i class="fas fa-clock me-2"></i>Reload Timing</h6>
                            <ul class="mb-0">
                                <li>Change detection: Every 30 seconds</li>
                                <li>Full periodic reload: Every 5 minutes</li>
                                <li>Admin UI "Reload" button: Immediate</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <h6>Default File Creation</h6>
            <p>If configuration files are missing at startup, Kuber creates minimal defaults:</p>
            <table class="table table-bordered">
                <thead class="table-light">
                    <tr><th>Missing File</th><th>Default Created</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>users.json</code></td>
                        <td>Creates with <code>admin</code> user only (password: <code>admin123</code>)</td>
                    </tr>
                    <tr>
                        <td><code>roles.json</code></td>
                        <td>Creates with <code>admin</code> role only (full access to all regions)</td>
                    </tr>
                </tbody>
            </table>
            
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>CRITICAL:</strong> If default files are created, change the admin password <strong>immediately</strong>! 
                The default password <code>admin123</code> is publicly documented.
            </div>
            
            <h6>Sample Configuration Files</h6>
            <p>Comprehensive examples are available in <code>secure-sample/</code>:</p>
            <ul>
                <li><code>users.json.sample</code> - Multiple user examples with various role assignments</li>
                <li><code>roles.json.sample</code> - Complete role definitions for multiple regions</li>
            </ul>
            <p>Copy and customize these files to create your configuration:</p>
            <pre class="bg-dark text-light p-3 rounded"><code>cp secure-sample/users.json.sample secure/users.json
cp secure-sample/roles.json.sample secure/roles.json
# Edit files with your users and roles</code></pre>
        </div>
    </div>

    <!-- Practical Examples -->
    <div class="card mb-4" id="examples">
        <div class="card-header"><h5 class="mb-0"><i class="fas fa-code me-2"></i>Practical Examples</h5></div>
        <div class="card-body">
            <h6>Scenario 1: Microservice Architecture</h6>
            <p>Each microservice has its own user with access only to relevant regions:</p>
            <pre class="bg-dark text-light p-3 rounded"><code>// roles.json - Service-specific roles
{
  "roles": [
    {"name": "orders_full", "region": "orders", "permissions": ["READ", "WRITE", "DELETE"]},
    {"name": "products_readonly", "region": "products", "permissions": ["READ"]},
    {"name": "inventory_readwrite", "region": "inventory", "permissions": ["READ", "WRITE"]}
  ]
}

// users.json - Service accounts
{
  "users": [
    {
      "userId": "order_service",
      "password": "secure_order_pass",
      "roles": ["orders_full", "products_readonly", "inventory_readwrite"]
    },
    {
      "userId": "catalog_service", 
      "password": "secure_catalog_pass",
      "roles": ["products_full"]
    }
  ]
}</code></pre>

            <h6 class="mt-4">Scenario 2: Development vs Production Access</h6>
            <p>Developers have full access to test regions, read-only to production:</p>
            <pre class="bg-dark text-light p-3 rounded"><code>// roles.json
{
  "roles": [
    {"name": "prod_readonly", "region": "production", "permissions": ["READ"]},
    {"name": "test_full", "region": "test", "permissions": ["READ", "WRITE", "DELETE"]},
    {"name": "dev_full", "region": "development", "permissions": ["READ", "WRITE", "DELETE"]}
  ]
}

// users.json
{
  "users": [
    {
      "userId": "developer1",
      "password": "dev_pass",
      "roles": ["prod_readonly", "test_full", "dev_full"]
    }
  ]
}</code></pre>

            <h6 class="mt-4">Scenario 3: Analytics/Reporting</h6>
            <p>Read-only access across multiple regions for dashboards:</p>
            <pre class="bg-dark text-light p-3 rounded"><code>// users.json
{
  "users": [
    {
      "userId": "analytics_dashboard",
      "password": "analytics_secure_2025",
      "roles": [
        "orders_readonly",
        "products_readonly", 
        "customers_readonly",
        "inventory_readonly"
      ]
    }
  ]
}</code></pre>
        </div>
    </div>

    <!-- API Authentication -->
    <div class="card mb-4" id="api-auth">
        <div class="card-header"><h5 class="mb-0"><i class="fas fa-plug me-2"></i>API Authentication</h5></div>
        <div class="card-body">
            <h6>Redis Protocol (AUTH Command)</h6>
            <pre class="bg-dark text-light p-3 rounded"><code># Using API Key
redis-cli -p 6380
> AUTH api_key_here
OK

# Using username/password (Redis 6+ ACL style)
> AUTH username password
OK</code></pre>

            <h6 class="mt-4">REST API (HTTP)</h6>
            <div class="row">
                <div class="col-md-6">
                    <p><strong>API Key in Header:</strong></p>
                    <pre class="bg-dark text-light p-3 rounded"><code>curl -H "X-API-Key: your_api_key" \
     http://localhost:8080/api/cache/default/keys</code></pre>
                </div>
                <div class="col-md-6">
                    <p><strong>HTTP Basic Auth:</strong></p>
                    <pre class="bg-dark text-light p-3 rounded"><code>curl -u username:password \
     http://localhost:8080/api/cache/default/keys</code></pre>
                </div>
            </div>

            <h6 class="mt-4">Python Client Example</h6>
            <pre class="bg-dark text-light p-3 rounded"><code>from kuber_client import KuberClient

# Connect with API key
client = KuberClient(host='localhost', port=6380, api_key='your_api_key')

# Or with username/password
client = KuberClient(host='localhost', port=6380, 
                     username='developer', password='dev123')

# Operations are now authorized based on user's roles
client.set('orders', 'order:123', '{"status": "pending"}')  # Requires WRITE
result = client.get('orders', 'order:123')                  # Requires READ
client.delete('orders', 'order:123')                        # Requires DELETE</code></pre>

            <h6 class="mt-4">Java Client Example</h6>
            <pre class="bg-dark text-light p-3 rounded"><code>// Using Jedis with API key authentication
Jedis jedis = new Jedis("localhost", 6380);
jedis.auth("your_api_key");

// Operations authorized based on API key's user roles
jedis.set("orders:order:123", "{\"status\": \"pending\"}");
String value = jedis.get("orders:order:123");
jedis.del("orders:order:123");</code></pre>
        </div>
    </div>

    <!-- Error Messages -->
    <div class="card mb-4" id="errors">
        <div class="card-header"><h5 class="mb-0"><i class="fas fa-exclamation-circle me-2"></i>Error Messages</h5></div>
        <div class="card-body">
            <table class="table table-bordered">
                <thead class="table-light">
                    <tr><th>Error Message</th><th>Cause</th><th>Solution</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>NOPERM READ permission denied for region 'X'</code></td>
                        <td>User lacks READ permission for the region</td>
                        <td>Assign a role with READ permission for the region</td>
                    </tr>
                    <tr>
                        <td><code>NOPERM WRITE permission denied for region 'X'</code></td>
                        <td>User lacks WRITE permission for the region</td>
                        <td>Assign a role with WRITE permission for the region</td>
                    </tr>
                    <tr>
                        <td><code>NOPERM DELETE permission denied for region 'X'</code></td>
                        <td>User lacks DELETE permission for the region</td>
                        <td>Assign a role with DELETE permission for the region</td>
                    </tr>
                    <tr>
                        <td><code>NOPERM admin permission required</code></td>
                        <td>Operation requires ADMIN permission</td>
                        <td>Only admin users can perform this operation</td>
                    </tr>
                    <tr>
                        <td><code>NOAUTH Authentication required</code></td>
                        <td>No authentication provided</td>
                        <td>Use AUTH command or provide credentials</td>
                    </tr>
                    <tr>
                        <td><code>ERR invalid password</code></td>
                        <td>Incorrect credentials</td>
                        <td>Verify username/password or API key</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- RBAC Enforcement -->
    <div class="card mb-4">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0"><i class="fas fa-layer-group me-2"></i>RBAC Enforcement Layers</h5>
        </div>
        <div class="card-body">
            <h6>Where RBAC is Enforced</h6>
            <table class="table table-bordered">
                <thead class="table-light">
                    <tr><th>Layer</th><th>Enforcement</th><th>Description</th></tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Web UI</strong></td>
                        <td><span class="badge bg-success">Enforced</span></td>
                        <td>All cache, region, and admin pages check permissions</td>
                    </tr>
                    <tr>
                        <td><strong>REST API</strong></td>
                        <td><span class="badge bg-success">Enforced</span></td>
                        <td>All <code>/api/*</code> endpoints check permissions</td>
                    </tr>
                    <tr>
                        <td><strong>Redis Protocol</strong></td>
                        <td><span class="badge bg-warning text-dark">AUTH Required</span></td>
                        <td>Commands require authentication (RBAC per-command coming)</td>
                    </tr>
                </tbody>
            </table>
            
            <h6 class="mt-4">Internal Services (No RBAC)</h6>
            <p>These system services operate with <strong>full admin privileges</strong> and bypass RBAC checks:</p>
            <table class="table table-bordered table-sm">
                <thead class="table-light">
                    <tr><th>Service</th><th>Purpose</th></tr>
                </thead>
                <tbody>
                    <tr><td><code>AutoloadService</code></td><td>Bulk data import from CSV/JSON files</td></tr>
                    <tr><td><code>BackupRestoreService</code></td><td>Backup and restore operations</td></tr>
                    <tr><td><code>ReplicationService</code></td><td>Primary/Secondary data synchronization</td></tr>
                    <tr><td><code>StartupOrchestrator</code></td><td>System initialization and recovery</td></tr>
                </tbody>
            </table>
            <div class="alert alert-info mb-0">
                <i class="fas fa-info-circle me-2"></i>
                <strong>By Design:</strong> Internal system processes require unrestricted access to function properly. 
                These services are not exposed to external users.
            </div>
        </div>
    </div>

    <!-- Best Practices -->
    <div class="card mb-4">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0"><i class="fas fa-lightbulb me-2"></i>Security Best Practices</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6><i class="fas fa-check text-success me-2"></i>Do</h6>
                    <ul>
                        <li>Change default admin password immediately</li>
                        <li>Use strong, unique passwords for each user</li>
                        <li>Apply principle of least privilege</li>
                        <li>Create separate service accounts for applications</li>
                        <li>Regularly audit user accounts and permissions</li>
                        <li>Use API keys for programmatic access</li>
                        <li>Keep security files outside version control</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h6><i class="fas fa-times text-danger me-2"></i>Don't</h6>
                    <ul>
                        <li>Share the admin account across users</li>
                        <li>Use the same password for multiple users</li>
                        <li>Grant more permissions than necessary</li>
                        <li>Commit security files to git</li>
                        <li>Disable RBAC in production</li>
                        <li>Forget to remove access for former users</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="d-flex justify-content-between mt-4">
        <a th:href="@{/help/apikeys}" class="btn btn-outline-primary">
            <i class="fas fa-arrow-left me-1"></i> API Keys
        </a>
        <a th:href="@{/help/quickstart}" class="btn btn-outline-primary">
            Quick Start <i class="fas fa-arrow-right ms-1"></i>
        </a>
    </div>
    
    <p class="text-muted text-center mt-4"><small>Version 1.9.0</small></p>
</div>
</main>

<footer th:replace="~{layout :: footer}"></footer>
<th:block th:replace="~{layout :: scripts}"></th:block>
</body>
</html>
