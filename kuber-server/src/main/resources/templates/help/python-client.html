<!DOCTYPE html>
<!--
  ~ Copyright © 2025-2030, All Rights Reserved
  ~ Ashutosh Sinha | Email: ajsinha@gmail.com
  ~ Patent Pending
  -->
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head('Python Client')}"></head>
<body class="d-flex flex-column min-vh-100">

<nav th:replace="~{layout :: navbar}"></nav>

<main class="flex-fill">
    <div class="container-fluid py-4">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/help"><i class="fas fa-book me-1"></i>Help</a></li>
                <li class="breadcrumb-item active" aria-current="page">Python Client</li>
            </ol>
        </nav>

        <!-- Content -->
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <h1 class="display-5 mb-4"><i class="fab fa-python me-3 text-info"></i>Python Client</h1>
                
                <div class="alert alert-warning">
                    <i class="fas fa-key me-2"></i>
                    <strong>v1.6.5: API Key Authentication Required</strong><br>
                    All programmatic access requires an API key. Create one in <a href="/admin/apikeys">Admin → API Keys</a>.
                </div>
                
                <div class="alert alert-info">
                    <i class="fas fa-shield-alt me-2"></i>
                    <strong>v1.7.7: Role-Based Access Control</strong><br>
                    Operations are authorized based on the user's roles. API keys inherit permissions from the associated user.
                    Ensure your user has appropriate permissions (READ, WRITE, DELETE) for the regions you access.
                    See <a href="/help/security">Security &amp; RBAC</a> for details.
                </div>

                <!-- Table of Contents -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-list me-2"></i>Contents</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <ul class="list-unstyled mb-0">
                                    <li><a href="#redis-client">Redis Protocol Client</a></li>
                                    <li><a href="#rest-client">REST API Client</a></li>
                                    <li><a href="#redis-py">Using redis-py</a></li>
                                    <li><a href="#json-ops">JSON Operations</a></li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul class="list-unstyled mb-0">
                                    <li><a href="#standalone">Standalone Client Files</a></li>
                                    <li><a href="#regions">Region Management</a></li>
                                    <li><a href="#messaging">Request/Response Messaging</a> <span class="badge bg-success">v1.7.1</span></li>
                                    <li><a href="#complete-example">Complete Example</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Redis Protocol Client -->
                <section id="redis-client" class="mb-5">
                    <h3 class="border-bottom pb-2"><i class="fas fa-plug me-2"></i>Redis Protocol Client (KuberClient)</h3>
                    
                    <h4>Installation</h4>
                    <pre class="bg-dark text-light p-3 rounded"><code># Install from package
pip install kuber-client

# Or copy kuber/client.py to your project</code></pre>

                    <h4 class="mt-4">Basic Usage</h4>
                    <pre class="bg-dark text-light p-3 rounded"><code>from kuber import KuberClient

# API Key required (get from Admin → API Keys)
api_key = "kub_your_api_key_here"

with KuberClient('localhost', 6380, api_key=api_key) as client:
    # Test connection
    print(client.ping())  # PONG
    
    # String operations
    client.set('user:1001', 'John Doe')
    name = client.get('user:1001')
    print(f"User: {name}")
    
    # Set with TTL
    from datetime import timedelta
    client.set('session:abc', 'session-data', ttl=timedelta(hours=1))
    
    # Check TTL
    ttl = client.ttl('session:abc')
    print(f"TTL: {ttl} seconds")
    
    # Delete
    client.delete('user:1001')</code></pre>

                    <h4 class="mt-4">Constructor Options</h4>
                    <pre class="bg-dark text-light p-3 rounded"><code># Basic - API key required
client = KuberClient('localhost', 6380, api_key='kub_xxx')

# With custom timeout (60 seconds)
client = KuberClient('localhost', 6380, api_key='kub_xxx', timeout=60.0)

# With initial region
client = KuberClient('localhost', 6380, api_key='kub_xxx', region='users')</code></pre>
                </section>

                <!-- REST API Client -->
                <section id="rest-client" class="mb-5">
                    <h3 class="border-bottom pb-2"><i class="fas fa-cloud me-2"></i>REST API Client (KuberRestClient)</h3>
                    
                    <h4>Basic Usage</h4>
                    <pre class="bg-dark text-light p-3 rounded"><code>from kuber import KuberRestClient

# API Key required (get from Admin → API Keys)
api_key = "kub_your_api_key_here"

client = KuberRestClient('localhost', 8080, api_key=api_key)

# Server info
info = client.info()
print(f"Server: {info}")

# String operations
client.set('key1', 'value1')
value = client.get('key1')
print(f"Value: {value}")

# Set with TTL (1 hour = 3600 seconds)
client.set('temp:key', 'temp-value', ttl=3600)

client.close()</code></pre>

                    <h4 class="mt-4">Constructor Options</h4>
                    <pre class="bg-dark text-light p-3 rounded"><code># Basic - API key required
client = KuberRestClient('localhost', 8080, api_key='kub_xxx')

# With SSL
client = KuberRestClient('localhost', 8443, api_key='kub_xxx', use_ssl=True)

# With custom timeout
client = KuberRestClient('localhost', 8080, api_key='kub_xxx', timeout=60.0)</code></pre>
                </section>

                <!-- Using redis-py -->
                <section id="redis-py" class="mb-5">
                    <h3 class="border-bottom pb-2"><i class="fas fa-terminal me-2"></i>Using redis-py</h3>
                    
                    <h4>Installation</h4>
                    <pre class="bg-dark text-light p-3 rounded"><code>pip install redis</code></pre>

                    <h4 class="mt-4">Basic Usage with API Key</h4>
                    <pre class="bg-dark text-light p-3 rounded"><code>import redis

api_key = "kub_your_api_key_here"

# Create connection (no auto-auth)
client = redis.Redis(host='localhost', port=6380, decode_responses=True)

# Authenticate with API key
client.execute_command('AUTH', api_key)

# Now use normally
client.set('key', 'value')
value = client.get('key')
print(f"Value: {value}")</code></pre>
                </section>

                <!-- JSON Operations -->
                <section id="json-ops" class="mb-5">
                    <h3 class="border-bottom pb-2"><i class="fas fa-code me-2"></i>JSON Operations</h3>
                    
                    <pre class="bg-dark text-light p-3 rounded"><code>with KuberClient('localhost', 6380, api_key='kub_xxx') as client:
    # Store JSON document
    user = {"name": "John", "age": 30, "status": "active", "email": "john@company.com", "temp": "x"}
    client.json_set('user:1001', user)
    
    # Get JSON document
    user = client.json_get('user:1001')
    print(f"User: {user}")
    
    # Get specific path
    name = client.json_get('user:1001', '$.name')
    print(f"Name: {name}")
    
    # Update/merge JSON (new in v1.7.2) - upsert with deep merge
    # Adds new fields, updates existing fields
    updated = client.json_update('user:1001', {'age': 31, 'city': 'NYC'})
    print(f"After merge: {updated}")  # {"name":"John","age":31,"status":"active","email":"...","city":"NYC","temp":"x"}
    
    # Remove attributes from JSON (new in v1.7.2)
    # Removes specified fields from the document
    result = client.json_remove('user:1001', ['temp', 'city'])
    print(f"After remove: {result}")  # {"name":"John","age":31,"status":"active","email":"..."}
    
    # Search JSON documents
    results = client.json_search('$.status=active')
    print(f"Active users: {len(results)}")
    
    # Search with comparison
    results = client.json_search('$.age>25')
    print(f"Users over 25: {len(results)}")</code></pre>
    
                    <h4 class="mt-4">JSON Command Summary</h4>
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead class="table-dark">
                                <tr>
                                    <th>Method</th>
                                    <th>Description</th>
                                    <th>Example</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>json_set(key, value)</code></td>
                                    <td>Store JSON document</td>
                                    <td><code>client.json_set('user:1', {'name': 'Alice'})</code></td>
                                </tr>
                                <tr>
                                    <td><code>json_get(key, path)</code></td>
                                    <td>Get JSON document or path</td>
                                    <td><code>client.json_get('user:1', '$.name')</code></td>
                                </tr>
                                <tr>
                                    <td><code>json_update(key, value)</code></td>
                                    <td>Merge JSON (upsert, deep merge)</td>
                                    <td><code>client.json_update('user:1', {'age': 31})</code></td>
                                </tr>
                                <tr>
                                    <td><code>json_remove(key, attrs)</code></td>
                                    <td>Remove attributes from JSON</td>
                                    <td><code>client.json_remove('user:1', ['age', 'temp'])</code></td>
                                </tr>
                                <tr>
                                    <td><code>json_delete(key, path)</code></td>
                                    <td>Delete JSON document or path</td>
                                    <td><code>client.json_delete('user:1')</code></td>
                                </tr>
                                <tr>
                                    <td><code>json_search(query)</code></td>
                                    <td>Search JSON documents</td>
                                    <td><code>client.json_search('$.age>25')</code></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
    
                    <h4 class="mt-4">JSON Search Operators</h4>
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped">
                            <thead class="table-dark">
                                <tr>
                                    <th>Operator</th>
                                    <th>Example</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td><code>=</code> or <code>==</code></td><td><code>$.status=active</code></td><td>Exact match</td></tr>
                                <tr><td><code>!=</code> or <code>&lt;&gt;</code></td><td><code>$.status!=inactive</code></td><td>Not equal</td></tr>
                                <tr><td><code>&gt;</code></td><td><code>$.age&gt;25</code></td><td>Greater than</td></tr>
                                <tr><td><code>&lt;</code></td><td><code>$.price&lt;100</code></td><td>Less than</td></tr>
                                <tr><td><code>&gt;=</code></td><td><code>$.salary&gt;=50000</code></td><td>Greater or equal</td></tr>
                                <tr><td><code>&lt;=</code></td><td><code>$.stock&lt;=10</code></td><td>Less or equal</td></tr>
                                <tr class="table-info"><td><code>~=</code></td><td><code>$.email~=.*@company\.com</code></td><td><strong>Regex match</strong></td></tr>
                                <tr><td><code>contains</code></td><td><code>$.name contains John</code></td><td>Substring match</td></tr>
                                <tr><td><code>startsWith</code></td><td><code>$.name startsWith J</code></td><td>Prefix match</td></tr>
                                <tr><td><code>endsWith</code></td><td><code>$.name endsWith son</code></td><td>Suffix match</td></tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <h5 class="mt-3">Regex Search Examples</h5>
                    <pre class="bg-dark text-light p-3 rounded"><code># Find users with company email
results = client.json_search('$.email~=.*@company\\.com')

# Find names starting with 'J'
results = client.json_search('$.name~=^J.*')

# Find 5-digit zip codes
results = client.json_search('$.address.zip~=\\d{5}')

# Combined search: Engineering dept AND name contains Smith
results = client.json_search('$.department=Engineering,$.name~=.*Smith.*')</code></pre>
                </section>

                <!-- Standalone Files -->
                <section id="standalone" class="mb-5">
                    <h3 class="border-bottom pb-2"><i class="fas fa-file-code me-2"></i>Standalone Client Files</h3>
                    <p>Ready-to-use standalone Python files (no installation required):</p>
                    
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <div class="card h-100">
                                <div class="card-header bg-primary text-white">
                                    <i class="fas fa-plug me-2"></i>Redis Protocol
                                </div>
                                <div class="card-body">
                                    <h6>kuber_redis_standalone.py</h6>
                                    <p class="small text-muted">Full-featured Redis protocol client with all operations.</p>
                                    <code class="small">python kuber_redis_standalone.py -k kub_xxx</code>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card h-100">
                                <div class="card-header bg-success text-white">
                                    <i class="fas fa-cloud me-2"></i>REST API
                                </div>
                                <div class="card-body">
                                    <h6>kuber_rest_standalone.py</h6>
                                    <p class="small text-muted">HTTP REST client using only standard library.</p>
                                    <code class="small">python kuber_rest_standalone.py -k kub_xxx</code>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card h-100">
                                <div class="card-header bg-info text-white">
                                    <i class="fas fa-search me-2"></i>JSON Demo
                                </div>
                                <div class="card-body">
                                    <h6>kuber_json_demo.py</h6>
                                    <p class="small text-muted">Demonstrates all JSON operations and search.</p>
                                    <code class="small">python kuber_json_demo.py -k kub_xxx</code>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="card h-100">
                                <div class="card-header text-white" style="background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);">
                                    <i class="fas fa-exchange-alt me-2"></i>Messaging <span class="badge bg-light text-dark">1.7.1</span>
                                </div>
                                <div class="card-body">
                                    <h6>kuber_messaging_example.py</h6>
                                    <p class="small text-muted">Request/response messaging via Kafka/RabbitMQ.</p>
                                    <code class="small">python kuber_messaging_example.py</code>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-secondary mt-3">
                        <i class="fas fa-folder-open me-2"></i>
                        <strong>Location:</strong> <code>kuber-client-python/</code> directory in the distribution archive.
                    </div>
                </section>

                <!-- Region Management -->
                <section id="regions" class="mb-5">
                    <h3 class="border-bottom pb-2"><i class="fas fa-database me-2"></i>Region Management</h3>
                    
                    <pre class="bg-dark text-light p-3 rounded"><code>with KuberClient('localhost', 6380, api_key='kub_xxx') as client:
    # List regions
    regions = client.list_regions()
    print(f"Regions: {regions}")
    
    # Create a new region
    client.create_region('sessions', 'User session storage')
    
    # Select region
    client.select_region('sessions')
    
    # All operations now apply to 'sessions' region
    client.set('sess:abc123', 'session-data')
    
    # Switch back to default
    client.select_region('default')</code></pre>
                </section>

                <!-- Messaging Section -->
                <section id="messaging" class="mb-5">
                    <h3 class="border-bottom pb-2"><i class="fas fa-exchange-alt me-2"></i>Request/Response Messaging <span class="badge bg-success">v1.7.1</span></h3>
                    <p>Access Kuber cache via message brokers (Kafka, RabbitMQ, IBM MQ, ActiveMQ).</p>
                    
                    <h4>Message Format</h4>
                    <pre class="bg-dark text-light p-3 rounded"><code>import json
import uuid

# Build a request message
request = {
    "api_key": "kub_your_api_key",
    "message_id": str(uuid.uuid4()),
    "operation": "GET",
    "region": "default",
    "key": "user:1001"
}

# Send to your broker's request topic (e.g., kuber_request)
message_json = json.dumps(request)

# Response will arrive on kuber_response topic:
# {
#   "request": { ... original request ... },
#   "response": {
#     "success": true,
#     "result": "{\"name\": \"John\"}",
#     "error": ""
#   },
#   "processing_time_ms": 2
# }</code></pre>

                    <h4 class="mt-4">Supported Operations</h4>
                    <div class="table-responsive">
                        <table class="table table-sm table-bordered">
                            <thead class="table-light">
                                <tr><th>Operation</th><th>Required Fields</th><th>Description</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>GET</td><td>key</td><td>Get value by key</td></tr>
                                <tr><td>SET</td><td>key, value</td><td>Set key-value (optional: ttl)</td></tr>
                                <tr><td>DELETE</td><td>key</td><td>Delete key</td></tr>
                                <tr><td>MGET</td><td>keys[]</td><td>Get multiple keys</td></tr>
                                <tr><td>MSET</td><td>entries{}</td><td>Set multiple key-value pairs</td></tr>
                                <tr><td>KEYS</td><td>pattern</td><td>Find keys by pattern</td></tr>
                                <tr><td>JSET</td><td>key, value</td><td>Set JSON document</td></tr>
                                <tr><td>JGET</td><td>key</td><td>Get JSON document</td></tr>
                                <tr><td>JSEARCH</td><td>query</td><td>Search JSON documents</td></tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="alert alert-info mt-3">
                        <i class="fas fa-book me-2"></i>
                        See the <a href="/help/messaging" class="alert-link">Request/Response Messaging</a> help page for complete documentation on message format, broker configuration, and backpressure management.
                    </div>
                </section>

                <!-- Complete Example -->
                <section id="complete-example" class="mb-5">
                    <h3 class="border-bottom pb-2"><i class="fas fa-code me-2"></i>Complete Example</h3>
                    
                    <pre class="bg-dark text-light p-3 rounded"><code>import os
from kuber import KuberClient

# Get API key from environment
API_KEY = os.environ.get('KUBER_API_KEY')
if not API_KEY or not API_KEY.startswith('kub_'):
    print("Set KUBER_API_KEY environment variable")
    exit(1)

with KuberClient('localhost', 6380, api_key=API_KEY) as client:
    print(f"Connected: {client.ping()}")
    
    # Create region for users
    client.create_region('users', 'User data')
    client.select_region('users')
    
    # Store user as JSON
    user = {
        "name": "John Doe",
        "email": "john@example.com",
        "age": 30,
        "status": "active"
    }
    client.json_set('user:1001', user)
    print("User stored")
    
    # Search for active users
    active_users = client.json_search('$.status=active')
    print(f"Found {len(active_users)} active users")
    
    # Hash operations
    client.hset('profile:1001', 'visits', '42')
    client.hincrby('profile:1001', 'visits', 1)
    visits = client.hget('profile:1001', 'visits')
    print(f"Visits: {visits}")
    
    # Clean up
    client.delete('user:1001', 'profile:1001')</code></pre>
                </section>

                <!-- Authentication Note -->
                <div class="alert alert-info">
                    <h5><i class="fas fa-info-circle me-2"></i>Getting an API Key</h5>
                    <ol class="mb-0">
                        <li>Log into the <a href="/login">Kuber Web UI</a> with your username/password</li>
                        <li>Navigate to <a href="/admin/apikeys">Admin → API Keys</a></li>
                        <li>Click <strong>Generate New Key</strong></li>
                        <li>Copy the generated key (starts with <code>kub_</code>)</li>
                        <li>Use this key in all Python client code</li>
                    </ol>
                </div>

                <!-- Back to Help -->
                <div class="mt-5 text-center">
                    <a href="/help" class="btn btn-outline-primary">
                        <i class="fas fa-arrow-left me-2"></i>Back to Help Index
                    </a>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="py-4 mt-5 border-top">
            <div class="row">
                <div class="col-md-6">
                    <h6><i class="fas fa-database me-2"></i><span th:text="${appName} ?: 'Kuber'">Kuber</span> Distributed Cache</h6>
                    <p class="text-muted small mb-0">Version 1.7.7</p>
                </div>
                <div class="col-md-6 text-end">
                    <p class="text-muted small mb-0">
                        Copyright &copy; 2025-2030, All Rights Reserved<br>
                        Ashutosh Sinha | <a href="mailto:ajsinha@gmail.com">ajsinha@gmail.com</a><br>
                        <span class="badge bg-warning text-dark">Patent Pending</span>
                    </p>
                </div>
            </div>
        </footer>
    </div>
</main>

<th:block th:replace="~{layout :: scripts}"></th:block>

</body>
</html>
