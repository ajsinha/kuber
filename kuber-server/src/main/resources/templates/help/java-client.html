<!DOCTYPE html>
<!--
  ~ Copyright Â© 2025-2030, All Rights Reserved
  ~ Ashutosh Sinha | Email: ajsinha@gmail.com
  ~ Patent Pending
  -->
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head('Java Client')}"></head>
<body class="d-flex flex-column min-vh-100">

<nav th:replace="~{layout :: navbar}"></nav>

<main class="flex-fill">
    <div class="container-fluid py-4">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/help"><i class="fas fa-book me-1"></i>Help</a></li>
                <li class="breadcrumb-item active" aria-current="page">Java Client</li>
            </ol>
        </nav>

        <!-- Content -->
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <h1 class="display-5 mb-4"><i class="fab fa-java me-3 text-danger"></i>Java Client</h1>
                
                <div class="alert alert-warning">
                    <i class="fas fa-info-circle me-2"></i>
                    Kuber is compatible with standard Java Redis clients like Jedis and Lettuce. You can also use Java's HttpClient for REST API access.
                </div>

                <!-- Table of Contents -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-list me-2"></i>Contents</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <ul class="list-unstyled mb-0">
                                    <li><a href="#dependencies">Maven Dependencies</a></li>
                                    <li><a href="#jedis">Jedis Examples</a></li>
                                    <li><a href="#rest-api">REST API with HttpClient</a></li>
                                    <li><a href="#region-management">Region Management</a></li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul class="list-unstyled mb-0">
                                    <li><a href="#json-ops">JSON Operations</a></li>
                                    <li><a href="#generic-search">Generic Search API</a></li>
                                    <li><a href="#spring-boot">Spring Boot Integration</a></li>
                                    <li><a href="#complete-example">Complete Example</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Maven Dependencies -->
                <section id="dependencies" class="mb-5">
                    <h3 class="border-bottom pb-2"><i class="fas fa-cube me-2"></i>Maven Dependencies</h3>
                    <pre class="bg-dark text-light p-3 rounded"><code>&lt;!-- Using Jedis --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;redis.clients&lt;/groupId&gt;
    &lt;artifactId&gt;jedis&lt;/artifactId&gt;
    &lt;version&gt;5.1.0&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- Jackson for JSON --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
    &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;
    &lt;version&gt;2.15.2&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
                </section>

                <!-- Jedis Examples -->
                <section id="jedis" class="mb-5">
                    <h3 class="border-bottom pb-2"><i class="fas fa-terminal me-2"></i>Jedis Examples</h3>
                    <pre class="bg-dark text-light p-3 rounded"><code>import redis.clients.jedis.Jedis;

public class KuberExample {
    public static void main(String[] args) {
        try (Jedis jedis = new Jedis("localhost", 6379)) {
            jedis.auth("admin123");
            
            // Test connection
            System.out.println("PING: " + jedis.ping());
            
            // String operations
            jedis.set("user:1001", "John Doe");
            String name = jedis.get("user:1001");
            System.out.println("User: " + name);
            
            // Set with TTL
            jedis.setex("session:abc", 3600, "session-data");
            
            // Check TTL
            long ttl = jedis.ttl("session:abc");
            System.out.println("TTL: " + ttl + " seconds");
            
            // Key pattern
            Set&lt;String&gt; keys = jedis.keys("user:*");
            System.out.println("Keys: " + keys);
            
            // Delete
            jedis.del("user:1001");
        }
    }
}</code></pre>
                </section>

                <!-- REST API -->
                <section id="rest-api" class="mb-5">
                    <h3 class="border-bottom pb-2"><i class="fas fa-cloud me-2"></i>REST API with HttpClient</h3>
                    <div class="alert alert-success">
                        <i class="fas fa-rocket me-2"></i><strong>Recommended:</strong> Copy the KuberRestApi class below for all REST operations.
                    </div>
                    <pre class="bg-dark text-light p-3 rounded"><code>import java.net.http.HttpClient;
import java.net.http.HttpRequest;
import java.net.http.HttpResponse;
import java.net.URI;
import java.time.Duration;
import java.util.*;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.JsonNode;

public class KuberRestApi {
    private final String baseUrl;
    private final HttpClient client;
    private final String authHeader;
    private final ObjectMapper mapper;
    
    public KuberRestApi(String host, int port, String username, String password) {
        this.baseUrl = String.format("http://%s:%d/api", host, port);
        this.client = HttpClient.newBuilder()
            .connectTimeout(Duration.ofSeconds(30))
            .build();
        this.authHeader = "Basic " + Base64.getEncoder()
            .encodeToString((username + ":" + password).getBytes());
        this.mapper = new ObjectMapper();
    }
    
    public JsonNode get(String endpoint) throws Exception {
        HttpRequest request = HttpRequest.newBuilder()
            .uri(URI.create(baseUrl + endpoint))
            .header("Authorization", authHeader)
            .GET()
            .build();
        HttpResponse&lt;String&gt; response = client.send(request, 
            HttpResponse.BodyHandlers.ofString());
        if (response.statusCode() == 404) return null;
        return response.body().isEmpty() ? null : mapper.readTree(response.body());
    }
    
    public JsonNode post(String endpoint, Object body) throws Exception {
        String json = body != null ? mapper.writeValueAsString(body) : "";
        HttpRequest request = HttpRequest.newBuilder()
            .uri(URI.create(baseUrl + endpoint))
            .header("Authorization", authHeader)
            .header("Content-Type", "application/json")
            .POST(HttpRequest.BodyPublishers.ofString(json))
            .build();
        HttpResponse&lt;String&gt; response = client.send(request, 
            HttpResponse.BodyHandlers.ofString());
        return response.body().isEmpty() ? null : mapper.readTree(response.body());
    }
    
    public boolean put(String endpoint, Object body) throws Exception {
        String json = body != null ? mapper.writeValueAsString(body) : "";
        HttpRequest request = HttpRequest.newBuilder()
            .uri(URI.create(baseUrl + endpoint))
            .header("Authorization", authHeader)
            .header("Content-Type", "application/json")
            .PUT(HttpRequest.BodyPublishers.ofString(json))
            .build();
        int status = client.send(request, HttpResponse.BodyHandlers.ofString()).statusCode();
        return status == 200 || status == 201;
    }
    
    public boolean delete(String endpoint) throws Exception {
        HttpRequest request = HttpRequest.newBuilder()
            .uri(URI.create(baseUrl + endpoint))
            .header("Authorization", authHeader)
            .DELETE()
            .build();
        int status = client.send(request, HttpResponse.BodyHandlers.ofString()).statusCode();
        return status == 200 || status == 204;
    }
    
    // Test connection
    public boolean testConnection() {
        try {
            JsonNode info = get("/info");
            if (info != null) {
                System.out.println("Connected to Kuber v" + info.get("version").asText());
                return true;
            }
        } catch (Exception e) {
            System.err.println("Connection failed: " + e.getMessage());
        }
        return false;
    }
}</code></pre>
                </section>

                <!-- Region Management -->
                <section id="region-management" class="mb-5">
                    <h3 class="border-bottom pb-2"><i class="fas fa-layer-group me-2"></i>Region Management</h3>
                    <pre class="bg-dark text-light p-3 rounded"><code>KuberRestApi api = new KuberRestApi("localhost", 8080, "admin", "admin123");

// List regions
JsonNode regions = api.get("/regions");
for (JsonNode r : regions) {
    System.out.println("Region: " + r.get("name").asText());
}

// Create region
api.post("/regions", Map.of("name", "customers", "description", "Customer data"));

// Set attribute mapping
api.put("/regions/customers/attributemapping", Map.of(
    "firstName", "first_name",
    "lastName", "last_name"
));

// Store data
api.put("/cache/customers/cust:1001", Map.of(
    "firstName", "John",
    "lastName", "Doe"
));
// Stored as: {"first_name": "John", "last_name": "Doe"}

// Get data
JsonNode result = api.get("/cache/customers/cust:1001");
System.out.println("Customer: " + result.get("value"));</code></pre>
                </section>

                <!-- JSON Operations -->
                <section id="json-ops" class="mb-5">
                    <h3 class="border-bottom pb-2"><i class="fas fa-code me-2"></i>JSON Operations</h3>
                    <pre class="bg-dark text-light p-3 rounded"><code>// Store JSON document
Map&lt;String, Object&gt; user = Map.of(
    "name", "John Doe",
    "age", 30,
    "status", "active",
    "address", Map.of(
        "city", "New York",
        "zip", "10001"
    )
);
api.put("/cache/users/user:1001", user);

// Get entire document
JsonNode doc = api.get("/cache/users/user:1001");
System.out.println("User: " + doc.get("value"));

// Get specific path
JsonNode city = api.get("/cache/users/user:1001/json?path=$.address.city");
System.out.println("City: " + city);

// JSON Search
JsonNode results = api.post("/cache/users/jsearch", Map.of(
    "query", "$.status=active"
));
System.out.println("Found: " + results.size() + " active users");</code></pre>
                </section>

                <!-- Generic Search API -->
                <section id="generic-search" class="mb-5">
                    <h3 class="border-bottom pb-2"><i class="fas fa-search-plus me-2"></i>Generic Search API</h3>
                    <pre class="bg-dark text-light p-3 rounded"><code>// Key pattern search
JsonNode results = api.post("/genericsearch", Map.of(
    "region", "users",
    "keypattern", "user:\\d+"
));

// Key pattern with field projection
results = api.post("/genericsearch", Map.of(
    "region", "users",
    "keypattern", "user:.*",
    "fields", List.of("name", "email"),
    "limit", 100
));

// JSON attribute search
results = api.post("/genericsearch", Map.of(
    "region", "users",
    "type", "json",
    "values", List.of(Map.of("status", "active"))
));

// Combined search with projection
results = api.post("/genericsearch", Map.of(
    "region", "products",
    "type", "json",
    "values", List.of(Map.of("category", "Electronics")),
    "fields", List.of("name", "price"),
    "limit", 50
));</code></pre>
                </section>

                <!-- Spring Boot Integration -->
                <section id="spring-boot" class="mb-5">
                    <h3 class="border-bottom pb-2"><i class="fas fa-leaf me-2"></i>Spring Boot Integration</h3>
                    <pre class="bg-dark text-light p-3 rounded"><code>// application.yml
spring:
  data:
    redis:
      host: localhost
      port: 6379
      password: admin123

// Configuration class
@Configuration
public class RedisConfig {
    @Bean
    public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory factory) {
        RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;&gt;();
        template.setConnectionFactory(factory);
        template.setKeySerializer(new StringRedisSerializer());
        template.setValueSerializer(new GenericJackson2JsonRedisSerializer());
        return template;
    }
}

// Service class
@Service
public class UserService {
    @Autowired
    private RedisTemplate&lt;String, Object&gt; redisTemplate;
    
    public void saveUser(String id, User user) {
        redisTemplate.opsForValue().set("user:" + id, user);
    }
    
    public User getUser(String id) {
        return (User) redisTemplate.opsForValue().get("user:" + id);
    }
}</code></pre>
                </section>

                <!-- Complete Example -->
                <section id="complete-example" class="mb-5">
                    <h3 class="border-bottom pb-2"><i class="fas fa-code me-2"></i>Complete Example: User Manager</h3>
                    <pre class="bg-dark text-light p-3 rounded"><code>public class KuberUserManager {
    private final KuberRestApi api;
    private final String region = "users";
    
    public KuberUserManager(String host, int port, String user, String pass) {
        this.api = new KuberRestApi(host, port, user, pass);
        setupRegion();
    }
    
    private void setupRegion() {
        try {
            api.post("/regions", Map.of("name", region));
            api.put("/regions/" + region + "/attributemapping", Map.of(
                "firstName", "first_name",
                "lastName", "last_name"
            ));
        } catch (Exception e) { /* Region may exist */ }
    }
    
    public boolean createUser(String id, Map&lt;String, Object&gt; data) throws Exception {
        return api.put("/cache/" + region + "/user:" + id, data);
    }
    
    public JsonNode getUser(String id) throws Exception {
        JsonNode result = api.get("/cache/" + region + "/user:" + id);
        return result != null ? result.get("value") : null;
    }
    
    public List&lt;JsonNode&gt; findByStatus(String status) throws Exception {
        JsonNode results = api.post("/genericsearch", Map.of(
            "region", region,
            "type", "json",
            "values", List.of(Map.of("status", status))
        ));
        List&lt;JsonNode&gt; users = new ArrayList&lt;&gt;();
        if (results != null) {
            for (JsonNode n : results) users.add(n);
        }
        return users;
    }
    
    public static void main(String[] args) throws Exception {
        KuberUserManager mgr = new KuberUserManager("localhost", 8080, "admin", "admin123");
        mgr.createUser("1001", Map.of("firstName", "John", "lastName", "Doe", "status", "active"));
        System.out.println("User: " + mgr.getUser("1001"));
        System.out.println("Active: " + mgr.findByStatus("active").size());
    }
}</code></pre>
                </section>

                <!-- Back to Help -->
                <div class="mt-5 text-center">
                    <a href="/help" class="btn btn-outline-primary">
                        <i class="fas fa-arrow-left me-2"></i>Back to Help Index
                    </a>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="py-4 mt-5 border-top">
            <div class="row">
                <div class="col-md-6">
                    <h6><i class="fas fa-database me-2"></i><span th:text="${appName} ?: 'Kuber'">Kuber</span> Distributed Cache</h6>
                    <p class="text-muted small mb-0">Version 1.2.1</p>
                </div>
                <div class="col-md-6 text-end">
                    <p class="text-muted small mb-0">
                        Copyright &copy; 2025-2030, All Rights Reserved<br>
                        Ashutosh Sinha | <a href="mailto:ajsinha@gmail.com">ajsinha@gmail.com</a><br>
                        <span class="badge bg-warning text-dark">Patent Pending</span>
                    </p>
                </div>
            </div>
        </footer>
    </div>
</main>

<th:block th:replace="~{layout :: scripts}"></th:block>

</body>
</html>
