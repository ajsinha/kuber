<!DOCTYPE html>
<!--
  ~ Copyright (c) 2025-2030, All Rights Reserved
  ~ Ashutosh Sinha | Email: ajsinha@gmail.com
  ~ Patent Pending
  -->
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head('API Keys')}"></head>
<body class="d-flex flex-column min-vh-100">

<nav th:replace="~{layout :: navbar}"></nav>

<main class="flex-fill">
    <div class="container-fluid py-4">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/help"><i class="fas fa-book me-1"></i>Help</a></li>
                <li class="breadcrumb-item active" aria-current="page">API Keys</li>
            </ol>
        </nav>

        <!-- Content -->
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <h1 class="display-5 mb-4"><i class="fas fa-key me-3 text-warning"></i>API Key Authentication</h1>
                
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Version 1.2.6</strong> - API keys provide secure, revocable authentication for programmatic access 
                    to <span th:text="${appName} ?: 'Kuber'">Kuber</span>.
                </div>

                <!-- Overview -->
                <section class="mb-5">
                    <h2 class="border-bottom pb-2 mb-4">Overview</h2>
                    <p>API keys offer an alternative to username/password authentication for applications and services. 
                    They are ideal for:</p>
                    <ul>
                        <li><strong>CI/CD Pipelines</strong> - Automated deployments and testing</li>
                        <li><strong>Microservices</strong> - Service-to-service communication</li>
                        <li><strong>Scripts</strong> - Automation and batch processing</li>
                        <li><strong>Third-party Integrations</strong> - External systems accessing the cache</li>
                    </ul>
                    
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Security Note:</strong> Treat API keys like passwords. Never commit them to version control 
                        or expose them in client-side code.
                    </div>
                </section>

                <!-- Key Format -->
                <section class="mb-5">
                    <h2 class="border-bottom pb-2 mb-4">API Key Format</h2>
                    <p>Kuber API keys follow a specific format for easy identification:</p>
                    <pre class="bg-dark text-light p-3 rounded"><code>kub_[64 hexadecimal characters]

Example: kub_a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2</code></pre>
                    <p>The <code>kub_</code> prefix makes keys easily identifiable and helps prevent accidental use of other credentials.</p>
                </section>

                <!-- Generating Keys -->
                <section class="mb-5">
                    <h2 class="border-bottom pb-2 mb-4">Generating API Keys</h2>
                    <p>API keys are generated through the Admin UI:</p>
                    <ol>
                        <li>Log in as an administrator</li>
                        <li>Navigate to <strong>Admin → API Keys</strong> (or click the user menu → API Keys)</li>
                        <li>Click <strong>"Generate New Key"</strong></li>
                        <li>Fill in the required fields:
                            <ul>
                                <li><strong>Name</strong>: Descriptive identifier (e.g., "Production API", "CI Pipeline")</li>
                                <li><strong>Associated User</strong>: The user account this key acts as</li>
                                <li><strong>Roles</strong>: Permissions for this key (USER, OPERATOR, ADMIN)</li>
                                <li><strong>Expiration</strong>: Optional number of days until the key expires</li>
                            </ul>
                        </li>
                        <li>Click <strong>"Generate Key"</strong></li>
                        <li><strong>Important:</strong> Copy the key immediately - it won't be shown again!</li>
                    </ol>
                </section>

                <!-- Using API Keys -->
                <section class="mb-5">
                    <h2 class="border-bottom pb-2 mb-4">Using API Keys</h2>
                    
                    <h4 class="mt-4">REST API</h4>
                    <p>API keys can be provided in three ways:</p>
                    
                    <h5>1. X-API-Key Header (Recommended)</h5>
                    <pre class="bg-dark text-light p-3 rounded"><code>curl -H "X-API-Key: kub_your_api_key_here" \
     http://localhost:8080/api/cache/mykey</code></pre>
                    
                    <h5>2. Authorization Header</h5>
                    <pre class="bg-dark text-light p-3 rounded"><code>curl -H "Authorization: ApiKey kub_your_api_key_here" \
     http://localhost:8080/api/cache/mykey</code></pre>
                    
                    <h5>3. Query Parameter</h5>
                    <pre class="bg-dark text-light p-3 rounded"><code>curl "http://localhost:8080/api/cache/mykey?api_key=kub_your_api_key_here"</code></pre>
                    
                    <div class="alert alert-info">
                        <i class="fas fa-lightbulb me-2"></i>
                        The X-API-Key header is recommended as it keeps the key out of URLs and server logs.
                    </div>
                    
                    <h4 class="mt-4">Redis Protocol</h4>
                    <p>Authenticate using the AUTH command:</p>
                    <pre class="bg-dark text-light p-3 rounded"><code># Using APIKEY keyword
AUTH APIKEY kub_your_api_key_here

# Or directly with the key
AUTH kub_your_api_key_here</code></pre>
                    
                    <h4 class="mt-4">Python Client</h4>
                    <pre class="bg-dark text-light p-3 rounded"><code>from kuber import KuberClient

# Using API key
client = KuberClient(
    host="localhost",
    port=8080,
    api_key="kub_your_api_key_here"
)

# Or for Redis protocol
import redis
r = redis.Redis(host='localhost', port=6380)
r.execute_command('AUTH', 'APIKEY', 'kub_your_api_key_here')
r.set('key', 'value')</code></pre>
                    
                    <h4 class="mt-4">Java Client</h4>
                    <pre class="bg-dark text-light p-3 rounded"><code>// REST Client with API key
KuberRestClient client = KuberRestClient.builder()
    .host("localhost")
    .port(8080)
    .apiKey("kub_your_api_key_here")
    .build();

client.set("key", "value");
String value = client.get("key");

// Redis Client with API key
try (Jedis jedis = new Jedis("localhost", 6380)) {
    jedis.auth("kub_your_api_key_here");
    jedis.set("key", "value");
}</code></pre>
                </section>

                <!-- Key Management -->
                <section class="mb-5">
                    <h2 class="border-bottom pb-2 mb-4">Key Management</h2>
                    
                    <h4>Key States</h4>
                    <table class="table table-bordered">
                        <thead class="table-light">
                            <tr><th>State</th><th>Description</th><th>Can Authenticate</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge bg-success">Active</span></td>
                                <td>Key is enabled and not expired</td>
                                <td>Yes</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-secondary">Revoked</span></td>
                                <td>Key has been manually disabled</td>
                                <td>No</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-danger">Expired</span></td>
                                <td>Key has passed its expiration date</td>
                                <td>No</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <h4 class="mt-4">Actions</h4>
                    <ul>
                        <li><strong>Revoke</strong>: Immediately disable a key (can be reactivated)</li>
                        <li><strong>Activate</strong>: Re-enable a previously revoked key</li>
                        <li><strong>Delete</strong>: Permanently remove a key (cannot be undone)</li>
                    </ul>
                </section>

                <!-- Roles and Permissions -->
                <section class="mb-5">
                    <h2 class="border-bottom pb-2 mb-4">Roles and Permissions</h2>
                    <p>API keys can be assigned one or more roles that determine their access level:</p>
                    
                    <table class="table table-bordered">
                        <thead class="table-light">
                            <tr><th>Role</th><th>Permissions</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="badge bg-secondary">USER</span></td>
                                <td>Read and write cache entries, execute searches</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-warning text-dark">OPERATOR</span></td>
                                <td>USER permissions + create/delete regions, view statistics</td>
                            </tr>
                            <tr>
                                <td><span class="badge bg-danger">ADMIN</span></td>
                                <td>Full access including user and API key management</td>
                            </tr>
                        </tbody>
                    </table>
                </section>

                <!-- Best Practices -->
                <section class="mb-5">
                    <h2 class="border-bottom pb-2 mb-4">Best Practices</h2>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card h-100 border-success">
                                <div class="card-header bg-success text-white">
                                    <i class="fas fa-check me-2"></i>Do
                                </div>
                                <div class="card-body">
                                    <ul class="mb-0">
                                        <li>Use environment variables to store keys</li>
                                        <li>Create separate keys for each application</li>
                                        <li>Set expiration dates for temporary access</li>
                                        <li>Revoke keys immediately if compromised</li>
                                        <li>Use the minimum required roles</li>
                                        <li>Monitor key usage via last-used timestamps</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100 border-danger">
                                <div class="card-header bg-danger text-white">
                                    <i class="fas fa-times me-2"></i>Don't
                                </div>
                                <div class="card-body">
                                    <ul class="mb-0">
                                        <li>Commit keys to version control</li>
                                        <li>Share keys between applications</li>
                                        <li>Use ADMIN role unless necessary</li>
                                        <li>Include keys in URLs (use headers instead)</li>
                                        <li>Log or display full key values</li>
                                        <li>Use keys without expiration for sensitive access</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Storage -->
                <section class="mb-5">
                    <h2 class="border-bottom pb-2 mb-4">Storage and Security</h2>
                    <p>API keys are stored in a JSON file. The location is configurable via <code>kuber.security.api-keys-file</code> property (default: <code>config/apikeys.json</code>). The file contains:</p>
                    <pre class="bg-dark text-light p-3 rounded"><code>[
  {
    "keyId": "key_abc12345",
    "keyValue": "kub_...",
    "name": "Production API",
    "userId": "admin",
    "roles": ["USER", "OPERATOR"],
    "createdAt": "2025-12-05T10:00:00Z",
    "lastUsedAt": "2025-12-05T15:30:00Z",
    "expiresAt": null,
    "active": true
  }
]</code></pre>
                    <div class="alert alert-warning">
                        <i class="fas fa-lock me-2"></i>
                        <strong>Security:</strong> Ensure proper file system permissions on the apikeys.json file. 
                        Only the Kuber server process should have read/write access.
                    </div>
                </section>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{layout :: footer}"></footer>

</body>
</html>
