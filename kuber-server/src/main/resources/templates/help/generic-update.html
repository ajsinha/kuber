<!DOCTYPE html>
<!--
  ~ Copyright © 2025-2030, All Rights Reserved
  ~ Ashutosh Sinha | Email: ajsinha@gmail.com
  ~ Patent Pending
  -->
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head('Generic Update API')}"></head>
<body class="d-flex flex-column min-vh-100">

<nav th:replace="~{layout :: navbar}"></nav>

<main class="flex-fill">
    <div class="container-fluid py-4">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/help"><i class="fas fa-book me-1"></i>Help</a></li>
                <li class="breadcrumb-item active" aria-current="page">Generic Update API</li>
            </ol>
        </nav>

        <!-- Content -->
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <h1 class="display-5 mb-4"><i class="fas fa-edit me-3 text-primary"></i>Generic Update API</h1>
                
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Version 1.8.3</strong> - Unified SET/UPDATE API with intelligent JSON merging capabilities.
                </div>

                <!-- Overview -->
                <div class="card mb-4">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Overview</h5>
                    </div>
                    <div class="card-body">
                        <p>The Generic Update API provides a unified endpoint for creating and updating cache entries.
                           When updating JSON data, it intelligently merges new values with existing data using JUPDATE logic.</p>
                        
                        <h6 class="mt-3">Endpoint</h6>
                        <pre class="bg-dark text-light p-3 rounded"><code>POST /api/genericupdate
POST /api/v1/genericupdate
POST /api/v2/genericupdate</code></pre>

                        <h6 class="mt-3">Key Features</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <ul>
                                    <li>Create new entries with any value type</li>
                                    <li>Replace existing values entirely</li>
                                    <li>Smart JSON merging with JUPDATE</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul>
                                    <li>Deep merge for nested objects</li>
                                    <li>Optional TTL support</li>
                                    <li>Auto-create regions if not exist</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Request Format -->
                <div class="card mb-4">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0"><i class="fas fa-file-code me-2"></i>Request Format</h5>
                    </div>
                    <div class="card-body">
                        <pre class="bg-dark text-light p-3 rounded"><code>{
    "apiKey": "kub_your_api_key",      // Required: API key for authentication
    "region": "users",                  // Required: Target region (auto-created if needed)
    "key": "user:123",                  // Required: Cache key to set/update
    "value": {...},                     // Required: Value (object, array, or scalar)
    "type": "json",                     // Optional: Set to "json" for merge semantics
    "ttl": 3600                         // Optional: TTL in seconds (-1 = no expiry)
}</code></pre>

                        <h6 class="mt-3">Request Parameters</h6>
                        <table class="table table-bordered table-sm">
                            <thead class="table-light">
                                <tr>
                                    <th>Parameter</th>
                                    <th>Type</th>
                                    <th>Required</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>apiKey</code></td>
                                    <td>string</td>
                                    <td><span class="badge bg-danger">Yes</span></td>
                                    <td>API key for authentication (starts with <code>kub_</code>)</td>
                                </tr>
                                <tr>
                                    <td><code>region</code></td>
                                    <td>string</td>
                                    <td><span class="badge bg-danger">Yes</span></td>
                                    <td>Target region name (auto-created if doesn't exist)</td>
                                </tr>
                                <tr>
                                    <td><code>key</code></td>
                                    <td>string</td>
                                    <td><span class="badge bg-danger">Yes</span></td>
                                    <td>Cache key to create or update</td>
                                </tr>
                                <tr>
                                    <td><code>value</code></td>
                                    <td>any</td>
                                    <td><span class="badge bg-danger">Yes</span></td>
                                    <td>Value to set (object, array, string, number, boolean)</td>
                                </tr>
                                <tr>
                                    <td><code>type</code></td>
                                    <td>string</td>
                                    <td><span class="badge bg-secondary">No</span></td>
                                    <td>Set to <code>"json"</code> for JSON merge semantics</td>
                                </tr>
                                <tr>
                                    <td><code>ttl</code></td>
                                    <td>number</td>
                                    <td><span class="badge bg-secondary">No</span></td>
                                    <td>Time-to-live in seconds (default: -1 = no expiry)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Behavior -->
                <div class="card mb-4">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0"><i class="fas fa-cogs me-2"></i>Behavior</h5>
                    </div>
                    <div class="card-body">
                        <h6>Operation Logic</h6>
                        <table class="table table-bordered table-sm">
                            <thead class="table-light">
                                <tr>
                                    <th>Key Exists?</th>
                                    <th>Type</th>
                                    <th>Action</th>
                                    <th>Result</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><span class="badge bg-secondary">No</span></td>
                                    <td>any</td>
                                    <td><strong>CREATE</strong></td>
                                    <td>New entry created with given value</td>
                                </tr>
                                <tr>
                                    <td><span class="badge bg-success">Yes</span></td>
                                    <td>not "json"</td>
                                    <td><strong>REPLACE</strong></td>
                                    <td>Value replaced entirely</td>
                                </tr>
                                <tr>
                                    <td><span class="badge bg-success">Yes</span></td>
                                    <td>"json"</td>
                                    <td><strong>MERGE</strong></td>
                                    <td>Values merged using JUPDATE logic</td>
                                </tr>
                            </tbody>
                        </table>

                        <h6 class="mt-4">JUPDATE Merge Logic</h6>
                        <p>When <code>type="json"</code> and key exists, the following merge rules apply:</p>
                        <ul>
                            <li><strong>Existing fields not in request</strong> → <span class="text-success">Preserved</span></li>
                            <li><strong>Fields in both</strong> → <span class="text-warning">Overwritten with new value</span></li>
                            <li><strong>New fields in request</strong> → <span class="text-primary">Added</span></li>
                            <li><strong>Nested objects</strong> → <span class="text-info">Deep merged recursively</span></li>
                            <li><strong>Arrays</strong> → <span class="text-danger">Replaced entirely (not merged)</span></li>
                        </ul>
                    </div>
                </div>

                <!-- Response Format -->
                <div class="card mb-4">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0"><i class="fas fa-reply me-2"></i>Response Format</h5>
                    </div>
                    <div class="card-body">
                        <h6>Success Response</h6>
                        <pre class="bg-dark text-light p-3 rounded"><code>{
    "success": true,
    "operation": "created",      // "created", "replaced", or "merged"
    "region": "users",
    "key": "user:123",
    "value": {...},              // The resulting value after operation
    "ttl": 3600                  // Only if TTL was set
}</code></pre>

                        <h6 class="mt-3">Operation Values</h6>
                        <table class="table table-bordered table-sm">
                            <thead class="table-light">
                                <tr>
                                    <th>Operation</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>created</code></td>
                                    <td>New entry was created (key didn't exist)</td>
                                </tr>
                                <tr>
                                    <td><code>replaced</code></td>
                                    <td>Existing value was replaced entirely (non-JSON type)</td>
                                </tr>
                                <tr>
                                    <td><code>merged</code></td>
                                    <td>Existing JSON was merged with new values (type="json")</td>
                                </tr>
                            </tbody>
                        </table>

                        <h6 class="mt-3">Error Response</h6>
                        <pre class="bg-dark text-light p-3 rounded"><code>{
    "success": false,
    "error": "Error message description"
}</code></pre>
                    </div>
                </div>

                <!-- Examples -->
                <div class="card mb-4">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0"><i class="fas fa-code me-2"></i>Examples</h5>
                    </div>
                    <div class="card-body">
                        <!-- Example 1: Create -->
                        <h6><i class="fas fa-plus-circle text-success me-2"></i>Example 1: Create New Entry</h6>
                        <pre class="bg-dark text-light p-3 rounded"><code>curl -X POST http://localhost:8080/api/genericupdate \
  -H "Content-Type: application/json" \
  -d '{
    "apiKey": "kub_xxxxx",
    "region": "users",
    "key": "user:1",
    "value": {"name": "John Doe", "email": "john@example.com", "age": 30},
    "type": "json",
    "ttl": 86400
  }'</code></pre>
                        <p class="small text-muted">Response: <code>{"success":true, "operation":"created", ...}</code></p>

                        <!-- Example 2: Merge -->
                        <h6 class="mt-4"><i class="fas fa-object-group text-primary me-2"></i>Example 2: Merge/Update JSON</h6>
                        <p class="small text-muted">Existing value: <code>{"name": "John Doe", "email": "john@example.com", "age": 30}</code></p>
                        <pre class="bg-dark text-light p-3 rounded"><code>curl -X POST http://localhost:8080/api/genericupdate \
  -H "Content-Type: application/json" \
  -d '{
    "apiKey": "kub_xxxxx",
    "region": "users",
    "key": "user:1",
    "value": {"email": "john.new@example.com", "city": "NYC", "verified": true},
    "type": "json"
  }'</code></pre>
                        <p class="small text-muted">Result: <code>{"name": "John Doe", "email": "john.new@example.com", "age": 30, "city": "NYC", "verified": true}</code></p>

                        <!-- Example 3: Replace -->
                        <h6 class="mt-4"><i class="fas fa-sync-alt text-warning me-2"></i>Example 3: Replace (non-JSON)</h6>
                        <pre class="bg-dark text-light p-3 rounded"><code>curl -X POST http://localhost:8080/api/genericupdate \
  -H "Content-Type: application/json" \
  -d '{
    "apiKey": "kub_xxxxx",
    "region": "counters",
    "key": "page_views",
    "value": 42
  }'</code></pre>
                        <p class="small text-muted">Response: <code>{"success":true, "operation":"replaced", ...}</code></p>

                        <!-- Example 4: Deep Merge -->
                        <h6 class="mt-4"><i class="fas fa-layer-group text-info me-2"></i>Example 4: Deep Merge Nested Objects</h6>
                        <p class="small text-muted">Existing value:</p>
                        <pre class="bg-light p-2 rounded small"><code>{"profile": {"name": "John", "settings": {"theme": "dark", "notifications": true}}, "lastLogin": "2025-01-01"}</code></pre>
                        <pre class="bg-dark text-light p-3 rounded"><code>curl -X POST http://localhost:8080/api/genericupdate \
  -H "Content-Type: application/json" \
  -d '{
    "apiKey": "kub_xxxxx",
    "region": "users",
    "key": "user:1",
    "value": {"profile": {"settings": {"theme": "light", "language": "en"}}},
    "type": "json"
  }'</code></pre>
                        <p class="small text-muted">Result (deep merged):</p>
                        <pre class="bg-light p-2 rounded small"><code>{"profile": {"name": "John", "settings": {"theme": "light", "notifications": true, "language": "en"}}, "lastLogin": "2025-01-01"}</code></pre>
                    </div>
                </div>

                <!-- Python Example -->
                <div class="card mb-4">
                    <div class="card-header" style="background: linear-gradient(135deg, #306998 0%, #FFD43B 100%);">
                        <h5 class="mb-0 text-white"><i class="fab fa-python me-2"></i>Python Example</h5>
                    </div>
                    <div class="card-body">
                        <pre class="bg-dark text-light p-3 rounded"><code>import requests

def generic_update(base_url, api_key, region, key, value, 
                   data_type=None, ttl=None):
    payload = {
        "apiKey": api_key,
        "region": region,
        "key": key,
        "value": value
    }
    if data_type:
        payload["type"] = data_type
    if ttl:
        payload["ttl"] = ttl
    
    response = requests.post(f"{base_url}/api/genericupdate", json=payload)
    return response.json()

# Usage
result = generic_update(
    base_url="http://localhost:8080",
    api_key="kub_xxxxx",
    region="users",
    key="user:123",
    value={"status": "active", "lastSeen": "2025-01-15"},
    data_type="json",
    ttl=3600
)
print(result)</code></pre>
                    </div>
                </div>

                <!-- Java Example -->
                <div class="card mb-4">
                    <div class="card-header" style="background: linear-gradient(135deg, #f89820 0%, #5382a1 100%);">
                        <h5 class="mb-0 text-white"><i class="fab fa-java me-2"></i>Java Example</h5>
                    </div>
                    <div class="card-body">
                        <pre class="bg-dark text-light p-3 rounded"><code>import java.net.http.*;
import java.net.URI;
import com.fasterxml.jackson.databind.ObjectMapper;
import java.util.*;

public class GenericUpdateExample {
    private static final ObjectMapper mapper = new ObjectMapper();
    
    public static Map&lt;String, Object&gt; genericUpdate(
            String baseUrl, String apiKey, String region, 
            String key, Object value, String type, Long ttl) throws Exception {
        
        Map&lt;String, Object&gt; request = new LinkedHashMap&lt;&gt;();
        request.put("apiKey", apiKey);
        request.put("region", region);
        request.put("key", key);
        request.put("value", value);
        if (type != null) request.put("type", type);
        if (ttl != null) request.put("ttl", ttl);
        
        HttpClient client = HttpClient.newHttpClient();
        HttpRequest httpRequest = HttpRequest.newBuilder()
            .uri(URI.create(baseUrl + "/api/genericupdate"))
            .header("Content-Type", "application/json")
            .POST(HttpRequest.BodyPublishers.ofString(mapper.writeValueAsString(request)))
            .build();
        
        HttpResponse&lt;String&gt; response = client.send(httpRequest, 
            HttpResponse.BodyHandlers.ofString());
        
        return mapper.readValue(response.body(), Map.class);
    }
}</code></pre>
                    </div>
                </div>

                <!-- Error Codes -->
                <div class="card mb-4">
                    <div class="card-header bg-danger text-white">
                        <h5 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Error Codes</h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-bordered table-sm">
                            <thead class="table-light">
                                <tr>
                                    <th>HTTP Status</th>
                                    <th>Error</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>401</code></td>
                                    <td>API key is required</td>
                                    <td>Missing <code>apiKey</code> in request</td>
                                </tr>
                                <tr>
                                    <td><code>401</code></td>
                                    <td>Invalid API key</td>
                                    <td>API key validation failed</td>
                                </tr>
                                <tr>
                                    <td><code>400</code></td>
                                    <td>region is required</td>
                                    <td>Missing <code>region</code> in request</td>
                                </tr>
                                <tr>
                                    <td><code>400</code></td>
                                    <td>key is required</td>
                                    <td>Missing <code>key</code> in request</td>
                                </tr>
                                <tr>
                                    <td><code>400</code></td>
                                    <td>value is required</td>
                                    <td>Missing <code>value</code> in request</td>
                                </tr>
                                <tr>
                                    <td><code>500</code></td>
                                    <td>Update failed</td>
                                    <td>Internal error during update operation</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Best Practices -->
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="fas fa-lightbulb me-2"></i>Best Practices</h5>
                    </div>
                    <div class="card-body">
                        <ul>
                            <li><strong>Use JSON Type for Partial Updates:</strong> When you only need to update specific fields, use <code>type: "json"</code> to merge instead of replacing the entire document.</li>
                            <li><strong>Set Appropriate TTLs:</strong> Use TTL for session data, caches, and temporary values. Omit TTL for permanent data.</li>
                            <li><strong>Check Operation Result:</strong> The <code>operation</code> field tells you what happened: <code>created</code>, <code>replaced</code>, or <code>merged</code>.</li>
                            <li><strong>Handle Errors:</strong> Always check the <code>success</code> field and handle errors appropriately.</li>
                            <li><strong>Combine with Generic Search:</strong> Use <code>/api/genericsearch</code> to find entries and <code>/api/genericupdate</code> to modify them.</li>
                        </ul>
                    </div>
                </div>

                <!-- Related -->
                <div class="card mb-4">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0"><i class="fas fa-link me-2"></i>Related Topics</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <a href="/help/generic-search" class="btn btn-outline-primary w-100 mb-2">
                                    <i class="fas fa-search me-2"></i>Generic Search API
                                </a>
                            </div>
                            <div class="col-md-4">
                                <a href="/help/json-ops" class="btn btn-outline-primary w-100 mb-2">
                                    <i class="fas fa-code me-2"></i>JSON Operations
                                </a>
                            </div>
                            <div class="col-md-4">
                                <a href="/help/apikeys" class="btn btn-outline-primary w-100 mb-2">
                                    <i class="fas fa-key me-2"></i>API Keys
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</main>

<footer th:replace="~{layout :: footer}"></footer>

<script th:src="@{/webjars/bootstrap/5.3.3/js/bootstrap.bundle.min.js}"></script>
</body>
</html>
