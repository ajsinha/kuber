<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head('Autoload - Bulk Import')}"></head>
<body class="d-flex flex-column min-vh-100">
<nav th:replace="~{layout :: navbar}"></nav>
<main class="flex-fill">
    <div class="container-fluid py-4">
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/help"><i class="fas fa-book me-1"></i>Help</a></li>
                <li class="breadcrumb-item active">Autoload - Bulk Import</li>
            </ol>
        </nav>
        <div class="row">
            <div class="col-lg-10 mx-auto">
                <h1 class="display-5 mb-4"><i class="fas fa-upload me-3"></i>Autoload - Bulk Import</h1>

                <h3>Overview</h3>
                <p>Import data from CSV, TXT, and JSON files by placing them in the autoload directory.</p>
                
                <div class="alert alert-info mt-3">
                    <i class="fas fa-bolt me-2"></i>
                    <strong>Batch Writes (v1.5.0):</strong>
                    Records are written in batches for 10-50x faster loading. Configure with <code>kuber.autoload.batch-size</code> (default: 2048).
                </div>
                
                <h3 class="mt-4">Configuration</h3>
                <pre class="bg-light p-3 rounded"><code>kuber:
  autoload:
    enabled: true
    directory: ./autoload
    scan-interval-seconds: 60
    batch-size: 8192        # Records per batch (v1.5.0)
    max-records-per-file: 0 # 0 = unlimited
    create-directories: true
    file-encoding: UTF-8</code></pre>
                
                <h3 class="mt-4">Supported File Formats</h3>
                <table class="table table-bordered">
                    <thead class="table-light">
                        <tr><th>Extension</th><th>Format</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>.csv</code></td><td>CSV</td><td>Comma-separated values with header row</td></tr>
                        <tr><td><code>.txt</code></td><td>Text</td><td>Delimited text file (processed same as CSV)</td></tr>
                        <tr><td><code>.json</code></td><td>JSONL</td><td>JSON Lines format (one JSON object per line)</td></tr>
                    </tbody>
                </table>
                
                <h3 class="mt-4">Directory Structure</h3>
                <pre class="bg-light p-3 rounded"><code>data/autoload/
├── inbox/          # Place files here
│   ├── data.csv
│   └── data.csv.metadata
└── outbox/         # Processed files moved here</code></pre>
                
                <h3 class="mt-4">Metadata File Format</h3>
                <pre class="bg-dark text-light p-3 rounded"><code>region:customers
key_field:customer_id
ttl:3600
delimiter:,</code></pre>
                
                <h3 class="mt-4">Composite Keys</h3>
                <p>Use <code>/</code> separator in <code>key_field</code> to create composite keys from multiple fields:</p>
                <pre class="bg-dark text-light p-3 rounded"><code>region:locations
key_field:country/state/city
ttl:3600</code></pre>
                <p>This extracts values from "country", "state", and "city" fields and joins them:</p>
                <ul>
                    <li>Input: <code>{"country":"US","state":"CA","city":"Los Angeles"}</code></li>
                    <li>Key: <code>US/CA/Los Angeles</code></li>
                </ul>
                <p>Customize the join delimiter with <code>key_delimiter</code>:</p>
                <pre class="bg-dark text-light p-3 rounded"><code>key_field:country/state/city
key_delimiter:-</code></pre>
                <p>Result: <code>US-CA-Los Angeles</code></p>
                
                <div class="alert alert-info mt-3">
                    <i class="fas fa-info-circle me-2"></i><strong>Empty Key Components (v1.5.0):</strong>
                    One or more key components can be empty. Records are still processed:
                    <ul class="mb-0 mt-2">
                        <li><code>{"country":"US","state":"","city":"LA"}</code> → Key: <code>US//LA</code> ✓</li>
                        <li><code>{"country":"","state":"CA","city":""}</code> → Key: <code>/CA/</code> ✓</li>
                        <li><code>{"country":"","state":"","city":""}</code> → Key: <code>//</code> (skipped - all empty)</li>
                    </ul>
                </div>
                
                <h3 class="mt-4">Attribute Mapping</h3>
                <p>Create <code>data.csv.metadata.attributemapping.json</code>:</p>
                <pre class="bg-dark text-light p-3 rounded"><code>{
    "firstName": "first_name",
    "lastName": "last_name"
}</code></pre>
                <div class="mt-5 text-center">
                    <a href="/help" class="btn btn-outline-primary"><i class="fas fa-arrow-left me-2"></i>Back to Help Index</a>
                </div>
            </div>
        </div>
        <footer class="py-4 mt-5 border-top">
            <div class="row">
                <div class="col-md-6"><h6><i class="fas fa-database me-2"></i><span th:text="${appName} ?: 'Kuber'">Kuber</span></h6><p class="text-muted small mb-0">Version 1.7.4</p></div>
                <div class="col-md-6 text-end"><p class="text-muted small mb-0">Copyright &copy; 2025-2030 Ashutosh Sinha<br><span class="badge bg-warning text-dark">Patent Pending</span></p></div>
            </div>
        </footer>
    </div>
</main>
<th:block th:replace="~{layout :: scripts}"></th:block>
</body>
</html>